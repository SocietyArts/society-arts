<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collections - Society Arts</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://pub-acb560f551f141db830964aed1fa005f.r2.dev/site-assets/SA_Monogram_Black%401x%201x1.png">
  
  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Familjen+Grotesk:wght@400;500;600;700&family=Domine:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/variables.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/help-modals.css">
  
  <style>
    /* ===== Page Layout (matching help.html) ===== */
    .collections-content {
      flex: 1;
      padding: var(--space-2xl);
      max-width: 900px;
      overflow-y: auto;
    }
    
    .collections-breadcrumb {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: var(--text-sm);
      color: var(--color-text-muted);
      margin-bottom: var(--space-md);
    }
    
    .collections-breadcrumb a {
      color: var(--color-text-muted);
      text-decoration: none;
      transition: color 0.2s;
    }
    
    .collections-breadcrumb a:hover {
      color: var(--color-accent);
    }
    
    .collections-header {
      margin-bottom: var(--space-2xl);
    }
    
    .collections-title {
      font-family: var(--font-serif);
      font-size: var(--text-3xl);
      font-weight: var(--weight-medium);
      color: var(--color-text-primary);
      margin: 0 0 var(--space-sm) 0;
    }
    
    .collections-subtitle {
      font-size: var(--text-base);
      color: var(--color-text-muted);
      margin: 0;
    }
    
    /* ===== Collections Grid ===== */
    .collections-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-lg);
    }
    
    .collection-card {
      background: var(--color-surface-alt);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--color-border-light);
    }
    
    .collection-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(62, 35, 24, 0.1);
    }
    
    .collection-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-md);
    }
    
    .collection-name {
      font-family: var(--font-serif);
      font-size: var(--text-lg);
      font-weight: var(--weight-medium);
      margin: 0;
    }
    
    .collection-count {
      font-size: var(--text-sm);
      color: var(--color-text-muted);
      background: var(--color-tan-10);
      padding: 4px 10px;
      border-radius: 12px;
    }
    
    .collection-description {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-md);
    }
    
    .collection-preview {
      display: flex;
      gap: 8px;
    }
    
    .collection-preview-img {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: var(--color-tan-10);
    }
    
    .collection-actions {
      display: flex;
      justify-content: flex-end;
      gap: var(--space-sm);
      margin-top: var(--space-md);
      padding-top: var(--space-md);
      border-top: 1px solid var(--color-border-light);
    }
    
    .collection-action-btn {
      padding: 6px 12px;
      border: none;
      background: transparent;
      color: var(--color-text-muted);
      font-size: var(--text-sm);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }
    
    .collection-action-btn:hover {
      background: var(--color-tan-10);
      color: var(--color-text-primary);
    }
    
    .collection-action-btn.danger:hover {
      background: #fee;
      color: #c00;
    }
    
    /* ===== New Collection Card ===== */
    .new-collection-card {
      background: transparent;
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 180px;
    }
    
    .new-collection-card:hover {
      border-color: var(--color-accent);
      background: var(--color-accent-light);
    }
    
    .new-collection-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--color-tan-10);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: var(--space-md);
      color: var(--color-text-muted);
    }
    
    .new-collection-card:hover .new-collection-icon {
      background: var(--color-accent);
      color: white;
    }
    
    .new-collection-text {
      font-size: var(--text-base);
      color: var(--color-text-muted);
    }
    
    /* ===== Empty & Loading States ===== */
    .empty-state {
      text-align: center;
      padding: var(--space-5xl) var(--space-xl);
    }
    
    .empty-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto var(--space-xl);
      background: var(--color-tan-10);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
    }
    
    .empty-title {
      font-family: var(--font-serif);
      font-size: var(--text-xl);
      margin-bottom: var(--space-sm);
    }
    
    .empty-text {
      color: var(--color-text-muted);
      margin-bottom: var(--space-xl);
    }
    
    .loading-state {
      text-align: center;
      padding: var(--space-5xl);
      color: var(--color-text-muted);
    }
    
    /* ===== Login Prompt ===== */
    .login-prompt {
      text-align: center;
      padding: var(--space-5xl) var(--space-xl);
    }
    
    .login-prompt h2 {
      font-family: var(--font-serif);
      margin-bottom: var(--space-md);
    }
    
    .login-prompt p {
      color: var(--color-text-muted);
      margin-bottom: var(--space-xl);
    }
    
    /* ===== Modal ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      width: 100%;
      max-width: 400px;
      margin: var(--space-md);
    }
    
    .modal-title {
      font-family: var(--font-serif);
      font-size: var(--text-xl);
      margin-bottom: var(--space-lg);
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      font-size: var(--text-base);
      margin-bottom: var(--space-md);
    }
    
    .modal-input:focus {
      outline: none;
      border-color: var(--color-accent);
    }
    
    .modal-actions {
      display: flex;
      gap: var(--space-sm);
      justify-content: flex-end;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/shared/supabase-client.js"></script>
  <script src="/js/shared/api.js"></script>
  <script src="/js/shared/auth.js"></script>
  <script src="/js/shared/header.js"></script>
  
  <!-- Collections App -->
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Chevron Icon for breadcrumb
    const ChevronRightIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );

    function CollectionsPage() {
      const { Header, Sidebar } = window.SocietyArts || {};
      
      if (!Sidebar || !Header) {
        return React.createElement('div', { className: 'loading-state' }, 'Loading...');
      }
      
      const { user, profile, isLoading: authLoading } = window.SocietyArts.useAuth();
      const { collections, isLoading, loadCollections, createCollection, deleteCollection } = window.SocietyArts.useCollections();
      const [authModalOpen, setAuthModalOpen] = useState(false);
      const [createModalOpen, setCreateModalOpen] = useState(false);
      const [newName, setNewName] = useState('');
      const [newDescription, setNewDescription] = useState('');

      useEffect(() => {
        if (user) {
          loadCollections();
        }
      }, [user]);

      const handleCreate = async () => {
        if (!newName.trim()) return;
        await createCollection(newName.trim(), newDescription.trim());
        setNewName('');
        setNewDescription('');
        setCreateModalOpen(false);
      };

      const handleDelete = async (e, collectionId) => {
        e.stopPropagation();
        if (confirm('Delete this collection? This cannot be undone.')) {
          await deleteCollection(collectionId);
        }
      };

      const getStyleImage = (styleId) => {
        return window.SocietyArts.getAltStyleThumbnailUrl(styleId);
      };

      const AuthModal = window.SocietyArts.AuthModal;

      return (
        <div className="page-container">
          <Sidebar />
          <Header user={user} profile={profile} />
          
          <main className="collections-content">
            {/* Breadcrumb */}
            <div className="collections-breadcrumb">
              <a href="index.html">Home</a>
              <ChevronRightIcon />
              <span>Collections</span>
            </div>
            
            {/* Page Header */}
            <div className="collections-header">
              <h1 className="collections-title">Collections</h1>
              <p className="collections-subtitle">Organize and save your favorite art styles</p>
            </div>
            
            {authLoading || isLoading ? (
              <div className="loading-state">Loading...</div>
            ) : !user ? (
              <div className="login-prompt">
                <h2>Sign in to view your collections</h2>
                <p>Create collections to organize your favorite styles.</p>
                <button 
                  className="btn btn-primary"
                  onClick={() => setAuthModalOpen(true)}
                >
                  Sign In
                </button>
              </div>
            ) : collections.length === 0 ? (
              <div className="empty-state">
                <div className="empty-icon">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
                    <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                    <polyline points="2 17 12 22 22 17"></polyline>
                    <polyline points="2 12 12 17 22 12"></polyline>
                  </svg>
                </div>
                <h2 className="empty-title">No collections yet</h2>
                <p className="empty-text">Create your first collection to organize styles.</p>
                <button 
                  className="btn btn-primary"
                  onClick={() => setCreateModalOpen(true)}
                >
                  Create Collection
                </button>
              </div>
            ) : (
              <div className="collections-grid">
                <div 
                  className="new-collection-card"
                  onClick={() => setCreateModalOpen(true)}
                >
                  <div className="new-collection-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </div>
                  <span className="new-collection-text">New Collection</span>
                </div>
                
                {collections.map((collection) => (
                  <div key={collection.id} className="collection-card">
                    <div className="collection-card-header">
                      <h3 className="collection-name">{collection.name}</h3>
                      <span className="collection-count">
                        {(collection.styles || []).length} styles
                      </span>
                    </div>
                    
                    {collection.description && (
                      <p className="collection-description">{collection.description}</p>
                    )}
                    
                    {(collection.styles || []).length > 0 && (
                      <div className="collection-preview">
                        {(collection.styles || []).slice(0, 4).map((styleId) => (
                          <img 
                            key={styleId}
                            src={getStyleImage(styleId)}
                            alt=""
                            className="collection-preview-img"
                            onError={(e) => e.target.style.display = 'none'}
                          />
                        ))}
                      </div>
                    )}
                    
                    <div className="collection-actions">
                      <button 
                        className="collection-action-btn danger"
                        onClick={(e) => handleDelete(e, collection.id)}
                      >
                        Delete
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </main>
          
          {authModalOpen && (
            <AuthModal 
              isOpen={authModalOpen}
              onClose={() => setAuthModalOpen(false)}
            />
          )}
          
          {createModalOpen && (
            <div className="modal-overlay" onClick={() => setCreateModalOpen(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 className="modal-title">New Collection</h2>
                <input 
                  type="text"
                  className="modal-input"
                  placeholder="Collection name"
                  value={newName}
                  onChange={(e) => setNewName(e.target.value)}
                  autoFocus
                />
                <input 
                  type="text"
                  className="modal-input"
                  placeholder="Description (optional)"
                  value={newDescription}
                  onChange={(e) => setNewDescription(e.target.value)}
                />
                <div className="modal-actions">
                  <button 
                    className="btn btn-ghost"
                    onClick={() => setCreateModalOpen(false)}
                  >
                    Cancel
                  </button>
                  <button 
                    className="btn btn-primary"
                    onClick={handleCreate}
                    disabled={!newName.trim()}
                  >
                    Create
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    
    function waitForComponents(callback, maxAttempts = 50) {
      let attempts = 0;
      const check = () => {
        attempts++;
        if (window.SocietyArts?.Sidebar && window.SocietyArts?.Header && window.SocietyArts?.useAuth) {
          callback();
        } else if (attempts < maxAttempts) {
          setTimeout(check, 100);
        } else {
          console.error('Components failed to load');
          callback();
        }
      };
      check();
    }
    
    waitForComponents(() => {
      root.render(<CollectionsPage />);
    });
  </script>
</body>
</html>
