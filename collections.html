<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collections - Society Arts</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://pub-acb560f551f141db830964aed1fa005f.r2.dev/site-assets/SA_Monogram_Black%401x%201x1.png">
  
  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Familjen+Grotesk:wght@400;500;600;700&family=Domine:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/variables.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/help-modals.css">
  
  <style>
    /* ===================================================
       COLLECTIONS PAGE - TYPOGRAPHIC SYSTEM
       Inspired by Art Center College of Design principles
       =================================================== */
    
    /* === Page Layout === */
    .collections-content {
      flex: 1;
      padding: var(--space-2xl);
      max-width: 1100px;
      overflow-y: auto;
    }
    
    /* === Breadcrumb Navigation === */
    .collections-breadcrumb {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.01em;
      color: var(--color-text-muted);
      margin-bottom: var(--space-lg);
    }
    
    .collections-breadcrumb a {
      color: var(--color-text-muted);
      text-decoration: none;
      transition: color 0.2s ease;
    }
    
    .collections-breadcrumb a:hover {
      color: var(--color-accent);
    }
    
    .collections-breadcrumb span:last-child {
      color: var(--color-text-primary);
    }
    
    /* === Page Header === */
    .collections-header {
      margin-bottom: var(--space-3xl);
    }
    
    .collections-title {
      font-family: var(--font-serif);
      font-size: clamp(32px, 5vw, 42px);
      font-weight: 500;
      letter-spacing: -0.02em;
      line-height: 1.1;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-sm) 0;
    }
    
    .collections-subtitle {
      font-family: var(--font-sans);
      font-size: 16px;
      font-weight: 400;
      letter-spacing: 0.005em;
      line-height: 1.5;
      color: var(--color-text-muted);
      margin: 0;
    }
    
    /* === Collection Grid === */
    .collections-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: var(--space-lg);
    }
    
    /* === Collection Card (Spotify-Inspired) === */
    .collection-card {
      position: relative;
      aspect-ratio: 1.1;
      min-height: 180px;
      border-radius: 8px;
      padding: var(--space-xl) var(--space-xl) var(--space-md) var(--space-xl);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .collection-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 8px;
      background: linear-gradient(
        180deg,
        transparent 0%,
        rgba(0, 0, 0, 0.03) 100%
      );
      pointer-events: none;
    }
    
    .collection-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.12),
        0 8px 16px rgba(0, 0, 0, 0.08);
    }
    
    /* Card Content Wrapper (title + description) */
    .collection-card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    
    /* Card Typography - Light text on dark backgrounds */
    .collection-card.text-light .collection-card-name,
    .collection-card.text-light .collection-card-meta {
      color: white;
    }
    
    .collection-card.text-light .collection-card-name {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    }
    
    .collection-card.text-light .collection-card-meta {
      color: rgba(255, 255, 255, 0.75);
    }
    
    /* Card Typography - Dark text on light backgrounds */
    .collection-card.text-dark .collection-card-name {
      color: var(--color-text-primary);
      text-shadow: none;
    }
    
    .collection-card.text-dark .collection-card-meta {
      color: rgba(62, 35, 24, 0.6);
    }
    
    /* Collection Name Typography */
    .collection-card-name {
      font-family: var(--font-serif);
      font-size: clamp(22px, 3vw, 26px);
      font-weight: 600;
      letter-spacing: -0.015em;
      line-height: 1.15;
      margin: 0;
      word-break: break-word;
      hyphens: auto;
      /* Limit to 2 lines when description present */
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    /* Collection Description (subtitle) */
    .collection-card-description {
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 400;
      line-height: 1.4;
      margin: 6px 0 0 0;
      opacity: 0.85;
      /* Limit to 2 lines */
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .collection-card.text-light .collection-card-description {
      color: rgba(255, 255, 255, 0.8);
    }
    
    .collection-card.text-dark .collection-card-description {
      color: rgba(62, 35, 24, 0.7);
    }
    
    /* Collection Meta (count) - Bottom Left */
    .collection-card-meta {
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.02em;
      margin: 0;
      padding-bottom: 2px;
    }
    
    /* Card Footer - holds meta and kebab */
    .collection-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }
    
    /* Kebab Menu Button */
    .collection-card-kebab {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      color: white;
      margin-right: -6px;
      margin-bottom: -4px;
    }
    
    .collection-card-kebab:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    .collection-card.text-dark .collection-card-kebab {
      color: var(--color-text-primary);
    }
    
    .collection-card.text-dark .collection-card-kebab:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    
    /* Kebab Dropdown Menu */
    .collection-card-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
      min-width: 160px;
      z-index: 1000;
      overflow: hidden;
      animation: menuDropDown 0.15s ease;
    }
    
    @keyframes menuDropDown {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .collection-card-menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--color-text-primary);
      cursor: pointer;
      transition: background 0.1s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }
    
    .collection-card-menu-item:hover {
      background: #f5f5f5;
    }
    
    .collection-card-menu-item.delete {
      color: #dc2626;
    }
    
    .collection-card-menu-item.delete:hover {
      background: #fef2f2;
    }
    
    .collection-card-menu-item svg {
      width: 16px;
      height: 16px;
      opacity: 0.7;
    }
    
    /* Folder icon for collections with sub-collections */
    .collection-card-icon {
      position: absolute;
      top: var(--space-lg);
      right: var(--space-lg);
      opacity: 0.5;
    }
    
    .collection-card.text-light .collection-card-icon {
      color: white;
    }
    
    .collection-card.text-dark .collection-card-icon {
      color: var(--color-text-primary);
    }
    
    /* === New Collection Card === */
    .new-collection-card {
      aspect-ratio: 1.1;
      min-height: 180px;
      border: 2px dashed var(--color-border);
      border-radius: 8px;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--space-md);
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .new-collection-card:hover {
      border-color: var(--color-accent);
      background: rgba(192, 113, 91, 0.06);
      transform: translateY(-4px);
    }
    
    .new-collection-icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--color-tan-10);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
      transition: all 0.25s ease;
    }
    
    .new-collection-card:hover .new-collection-icon {
      background: var(--color-accent);
      color: white;
      transform: scale(1.1);
    }
    
    .new-collection-text {
      font-family: var(--font-sans);
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.01em;
      color: var(--color-text-muted);
    }
    
    .new-collection-card:hover .new-collection-text {
      color: var(--color-accent);
    }
    
    /* === Back Navigation (when inside collection) === */
    .collections-back-nav {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-xl);
      padding: var(--space-md) 0;
      border-bottom: 1px solid var(--color-border-light);
    }
    
    .collections-back-btn {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      border: none;
      background: var(--color-surface-alt);
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 14px;
      font-weight: 500;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .collections-back-btn:hover {
      background: var(--color-tan-20);
      color: var(--color-text-primary);
    }
    
    /* === Section Headers (inside collection view) === */
    .collections-section-header {
      font-family: var(--font-sans);
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--color-text-muted);
      margin: var(--space-2xl) 0 var(--space-lg) 0;
    }
    
    .collections-section-header:first-of-type {
      margin-top: 0;
    }
    
    /* === Styles Grid (inside collection) === */
    .styles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: var(--space-md);
    }
    
    .style-thumbnail {
      position: relative;
      aspect-ratio: 1;
      border-radius: 6px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .style-thumbnail:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }
    
    .style-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .style-thumbnail-remove {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.6);
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    
    .style-thumbnail:hover .style-thumbnail-remove {
      opacity: 1;
    }
    
    .style-thumbnail-remove:hover {
      background: rgba(200, 0, 0, 0.8);
    }
    
    /* === Empty States === */
    .empty-state {
      text-align: center;
      padding: var(--space-5xl) var(--space-xl);
    }
    
    .empty-icon {
      width: 88px;
      height: 88px;
      margin: 0 auto var(--space-xl);
      background: var(--color-tan-10);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
    }
    
    .empty-title {
      font-family: var(--font-serif);
      font-size: 24px;
      font-weight: 500;
      letter-spacing: -0.01em;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-sm) 0;
    }
    
    .empty-text {
      font-family: var(--font-sans);
      font-size: 15px;
      color: var(--color-text-muted);
      margin: 0 0 var(--space-xl) 0;
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.5;
    }
    
    /* === Loading State === */
    .loading-state {
      text-align: center;
      padding: var(--space-5xl);
      color: var(--color-text-muted);
      font-family: var(--font-sans);
    }
    
    /* === Login Prompt === */
    .login-prompt {
      text-align: center;
      padding: var(--space-5xl) var(--space-xl);
    }
    
    .login-prompt h2 {
      font-family: var(--font-serif);
      font-size: 26px;
      font-weight: 500;
      letter-spacing: -0.01em;
      margin: 0 0 var(--space-md) 0;
    }
    
    .login-prompt p {
      font-family: var(--font-sans);
      font-size: 15px;
      color: var(--color-text-muted);
      margin: 0 0 var(--space-xl) 0;
    }
    
    /* === Modal Styles === */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: var(--space-2xl);
      width: 100%;
      max-width: 440px;
      margin: var(--space-md);
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px) scale(0.98);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .modal-title {
      font-family: var(--font-serif);
      font-size: 24px;
      font-weight: 500;
      letter-spacing: -0.01em;
      color: var(--color-text-primary);
      margin: 0;
      flex: 1;
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }
    
    .modal-info-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
      transition: all 0.15s ease;
      flex-shrink: 0;
      opacity: 0.5;
    }
    
    .modal-info-btn:hover {
      opacity: 1;
      background: rgba(0, 0, 0, 0.08);
    }
    
    .modal-info-btn svg {
      width: 20px;
      height: 20px;
      fill: var(--color-text-secondary);
    }
    
    /* === Delete Confirmation Modal === */
    .delete-modal-content {
      background: white;
      border-radius: 16px;
      padding: 0;
      width: 100%;
      max-width: 420px;
      margin: var(--space-md);
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }
    
    .delete-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-lg) var(--space-xl);
      background: #FEF2F2;
      border-bottom: 1px solid #FECACA;
    }
    
    .delete-modal-icon {
      width: 44px;
      height: 44px;
      background: #FEE2E2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #DC2626;
    }
    
    .delete-modal-body {
      padding: var(--space-xl);
    }
    
    .delete-modal-title {
      font-family: var(--font-serif);
      font-size: 22px;
      font-weight: 600;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-md) 0;
    }
    
    .delete-modal-message {
      font-family: var(--font-sans);
      font-size: 15px;
      line-height: 1.6;
      color: var(--color-text-secondary);
      margin: 0 0 var(--space-lg) 0;
    }
    
    .delete-modal-message strong {
      color: var(--color-text-primary);
      font-weight: 600;
    }
    
    .delete-modal-warning {
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: #FFFBEB;
      border: 1px solid #FDE68A;
      border-radius: var(--radius-md);
      margin-bottom: var(--space-lg);
    }
    
    .delete-modal-warning svg {
      flex-shrink: 0;
      color: #D97706;
    }
    
    .delete-modal-warning p {
      font-size: 13px;
      color: #92400E;
      margin: 0;
      line-height: 1.5;
    }
    
    .delete-modal-actions {
      display: flex;
      gap: var(--space-sm);
      justify-content: flex-end;
    }
    
    .btn-delete {
      padding: 12px 24px;
      border: none;
      background: #DC2626;
      color: white;
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s ease;
    }
    
    .btn-delete:hover {
      background: #B91C1C;
    }
    
    .btn-delete:disabled {
      background: #FCA5A5;
      cursor: not-allowed;
    }
    
    /* Delete Confirmation Input (Step 2) */
    .delete-confirm-input-wrapper {
      margin-bottom: var(--space-xl);
    }
    
    .delete-confirm-label {
      display: block;
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-sm);
    }
    
    .delete-confirm-label strong {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
      background: #FEE2E2;
      color: #991B1B;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
      letter-spacing: 0.05em;
    }
    
    .delete-confirm-input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--color-border);
      border-radius: 8px;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.1em;
      color: var(--color-text-primary);
      text-align: center;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }
    
    .delete-confirm-input:focus {
      outline: none;
      border-color: #DC2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.15);
    }
    
    .delete-confirm-input::placeholder {
      color: var(--color-text-light);
      font-weight: 400;
      letter-spacing: 0.05em;
    }
    
    .delete-confirm-input.valid {
      border-color: #16A34A;
      background: #F0FDF4;
    }
    
    .delete-confirm-input.valid:focus {
      box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.15);
    }
    
    /* === Share Modal === */
    .share-modal {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
      animation: modalSlideUp 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .share-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--color-border);
    }
    
    .share-modal-header h3 {
      font-family: var(--font-sans);
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      color: var(--color-text-primary);
    }
    
    .share-modal-body {
      padding: 24px;
    }
    
    .share-collection-name {
      font-family: var(--font-serif);
      font-size: 20px;
      font-weight: 600;
      font-style: italic;
      color: var(--color-text-primary);
      margin: 0 0 20px 0;
    }
    
    .share-label {
      display: block;
      font-family: var(--font-sans);
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin-bottom: 8px;
    }
    
    .share-link-section {
      margin-bottom: 24px;
    }
    
    .share-link-row {
      display: flex;
      gap: 8px;
    }
    
    .share-link-input {
      flex: 1;
      padding: 12px 14px;
      border: 1px solid var(--color-border);
      border-radius: 8px;
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--color-text-primary);
      background: #f9f9f9;
    }
    
    .share-copy-btn {
      padding: 12px 20px;
      white-space: nowrap;
    }
    
    .share-options-section {
      margin-bottom: 8px;
    }
    
    .share-options-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
    }
    
    .share-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 16px 8px;
      border: 1px solid var(--color-border);
      border-radius: 12px;
      background: white;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .share-option:hover {
      border-color: #C0715B;
      background: #FAF9F7;
    }
    
    .share-option span {
      font-family: var(--font-sans);
      font-size: 12px;
      color: var(--color-text-secondary);
    }
    
    .share-option-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .share-option-icon.email {
      background: #EA4335;
      color: white;
    }
    
    .share-option-icon.text {
      background: #34C759;
      color: white;
    }
    
    .share-option-icon.twitter {
      background: #000000;
      color: white;
    }
    
    .share-option-icon.facebook {
      background: #1877F2;
      color: white;
    }
    
    .share-option-icon.pinterest {
      background: #E60023;
      color: white;
    }
    
    @media (max-width: 480px) {
      .share-options-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    .modal-label {
      display: block;
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.02em;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-xs);
    }
    
    .modal-input {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid var(--color-border);
      border-radius: 8px;
      font-family: var(--font-sans);
      font-size: 15px;
      color: var(--color-text-primary);
      margin-bottom: var(--space-lg);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }
    
    .modal-input:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(192, 113, 91, 0.15);
    }
    
    .modal-input::placeholder {
      color: var(--color-text-light);
    }
    
    /* Color Picker Grid */
    .color-picker {
      margin-bottom: var(--space-lg);
    }
    
    .color-picker-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: var(--space-sm);
      margin-top: var(--space-sm);
    }
    
    .color-picker-swatch {
      aspect-ratio: 1;
      border-radius: 8px;
      border: 3px solid transparent;
      cursor: pointer;
      transition: transform 0.15s ease, border-color 0.15s ease;
    }
    
    .color-picker-swatch:hover {
      transform: scale(1.1);
    }
    
    .color-picker-swatch.selected {
      border-color: var(--color-text-primary);
      transform: scale(1.1);
    }
    
    .modal-actions {
      display: flex;
      gap: var(--space-sm);
      justify-content: flex-end;
      margin-top: var(--space-xl);
    }
    
    /* === Collection Header (inside view) === */
    .collection-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-xl);
      margin-bottom: var(--space-2xl);
      padding-bottom: var(--space-xl);
      border-bottom: 1px solid var(--color-border-light);
    }
    
    .collection-header-info {
      flex: 1;
    }
    
    .collection-header-color {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      flex-shrink: 0;
    }
    
    .collection-header-title {
      font-family: var(--font-serif);
      font-size: clamp(28px, 4vw, 36px);
      font-weight: 500;
      letter-spacing: -0.02em;
      line-height: 1.1;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-xs) 0;
    }
    
    .collection-header-meta {
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--color-text-muted);
      margin: 0 0 var(--space-md) 0;
    }
    
    .collection-header-actions {
      display: flex;
      gap: var(--space-sm);
    }
    
    .collection-action-btn {
      padding: 8px 16px;
      border: 1px solid var(--color-border);
      background: white;
      border-radius: 6px;
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 500;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .collection-action-btn:hover {
      border-color: var(--color-text-muted);
      color: var(--color-text-primary);
    }
    
    .collection-action-btn.danger:hover {
      border-color: #e53935;
      color: #e53935;
      background: #ffebee;
    }
    
    /* === Add Styles Card === */
    .add-style-card {
      aspect-ratio: 1;
      border: 2px dashed var(--color-border);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--color-text-muted);
    }
    
    .add-style-card:hover {
      border-color: var(--color-accent);
      color: var(--color-accent);
      background: rgba(192, 113, 91, 0.04);
    }
    
    .add-style-card span {
      font-family: var(--font-sans);
      font-size: 12px;
      font-weight: 500;
    }
    
    /* === Responsive === */
    @media (max-width: 768px) {
      .collections-content {
        padding: var(--space-lg);
      }
      
      .collections-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
      }
      
      .collection-card {
        min-height: 150px;
        padding: var(--space-lg);
      }
      
      .collection-card-name {
        font-size: 18px;
      }
      
      .collection-header {
        flex-direction: column-reverse;
        gap: var(--space-lg);
      }
      
      .collection-header-color {
        width: 60px;
        height: 60px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/shared/supabase-client.js"></script>
  <script src="/js/shared/api.js"></script>
  <script src="/js/shared/auth.js"></script>
  <script src="/js/shared/header.js"></script>
  <script src="/js/style-finder/style-data.js"></script>
  <script src="/js/shared/style-detail-modal.js"></script>
  <script src="/js/shared/add-to-collection-modal.js"></script>
  <script src="/js/shared/info-modal.js"></script>
  
  <!-- Collections App -->
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ==========================================
    // ICONS
    // ==========================================
    
    const ChevronRightIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );
    
    const ChevronLeftIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );
    
    const PlusIcon = () => (
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    
    const FolderIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
      </svg>
    );
    
    const LayersIcon = () => (
      <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
        <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
        <polyline points="2 17 12 22 22 17"></polyline>
        <polyline points="2 12 12 17 22 12"></polyline>
      </svg>
    );
    
    const XIcon = () => (
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );
    
    const KebabIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <circle cx="12" cy="5" r="2"></circle>
        <circle cx="12" cy="12" r="2"></circle>
        <circle cx="12" cy="19" r="2"></circle>
      </svg>
    );
    
    const DuplicateIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    );
    
    const EditIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg>
    );
    
    const TrashIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );
    
    const ShareIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
    );

    // ==========================================
    // DEFAULT PALETTE (fallback)
    // ==========================================
    
    const DEFAULT_PALETTE = [
      { id: 1, name: "Coral", hex: "#E07A5F", text: "light" },
      { id: 2, name: "Sage", hex: "#81B29A", text: "light" },
      { id: 3, name: "Ocean", hex: "#3D5A80", text: "light" },
      { id: 4, name: "Sunset", hex: "#F2994A", text: "dark" },
      { id: 5, name: "Plum", hex: "#9B5DE5", text: "light" },
      { id: 6, name: "Gold", hex: "#D4A853", text: "dark" },
      { id: 7, name: "Rose", hex: "#C97B84", text: "light" },
      { id: 8, name: "Forest", hex: "#588157", text: "light" },
      { id: 9, name: "Slate", hex: "#5C677D", text: "light" },
      { id: 10, name: "Peach", hex: "#FFBE98", text: "dark" },
      { id: 11, name: "Indigo", hex: "#5E60CE", text: "light" },
      { id: 12, name: "Copper", hex: "#B87333", text: "light" }
    ];

    // ==========================================
    // COLLECTION CARD COMPONENT
    // ==========================================
    
    function CollectionCard({ collection, palette, onClick, onEdit, onDelete, onDuplicate, onShare }) {
      const [menuOpen, setMenuOpen] = useState(false);
      const menuRef = React.useRef(null);
      
      const paletteColor = palette.find(c => c.hex === collection.color) || palette[0];
      const textClass = paletteColor.text === 'dark' ? 'text-dark' : 'text-light';
      
      const styleCount = collection.styles?.length || 0;
      const subCount = collection.subcollection_count || 0;
      
      let metaText = '';
      if (subCount > 0 && styleCount > 0) {
        metaText = `${subCount} folder${subCount !== 1 ? 's' : ''} Â· ${styleCount} style${styleCount !== 1 ? 's' : ''}`;
      } else if (subCount > 0) {
        metaText = `${subCount} folder${subCount !== 1 ? 's' : ''}`;
      } else {
        metaText = `${styleCount} style${styleCount !== 1 ? 's' : ''}`;
      }
      
      // Close menu when clicking outside
      useEffect(() => {
        const handleClickOutside = (e) => {
          if (menuRef.current && !menuRef.current.contains(e.target)) {
            setMenuOpen(false);
          }
        };
        if (menuOpen) {
          document.addEventListener('mousedown', handleClickOutside);
        }
        return () => document.removeEventListener('mousedown', handleClickOutside);
      }, [menuOpen]);
      
      const handleKebabClick = (e) => {
        e.stopPropagation();
        setMenuOpen(!menuOpen);
      };
      
      const handleMenuAction = (e, action) => {
        e.stopPropagation();
        setMenuOpen(false);
        action(collection);
      };
      
      return (
        <div 
          className={`collection-card ${textClass}`}
          style={{ backgroundColor: collection.color || paletteColor.hex }}
          onClick={() => onClick(collection)}
        >
          {subCount > 0 && (
            <div className="collection-card-icon">
              <FolderIcon />
            </div>
          )}
          <div className="collection-card-content">
            <h3 className="collection-card-name">{collection.name}</h3>
            {collection.description && (
              <p className="collection-card-description">{collection.description}</p>
            )}
          </div>
          <div className="collection-card-footer">
            <p className="collection-card-meta">{metaText}</p>
            <div ref={menuRef} style={{ position: 'relative', zIndex: menuOpen ? 1000 : 1 }}>
              <button 
                className="collection-card-kebab"
                onClick={handleKebabClick}
                title="More options"
              >
                <KebabIcon />
              </button>
              {menuOpen && (
                <div className="collection-card-menu">
                  <button className="collection-card-menu-item" onClick={(e) => handleMenuAction(e, onDuplicate)}>
                    <DuplicateIcon /> Duplicate
                  </button>
                  <button className="collection-card-menu-item" onClick={(e) => handleMenuAction(e, onEdit)}>
                    <EditIcon /> Edit
                  </button>
                  <button className="collection-card-menu-item" onClick={(e) => handleMenuAction(e, onShare)}>
                    <ShareIcon /> Share
                  </button>
                  <button className="collection-card-menu-item delete" onClick={(e) => handleMenuAction(e, onDelete)}>
                    <TrashIcon /> Delete
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ==========================================
    // NEW COLLECTION CARD COMPONENT
    // ==========================================
    
    function NewCollectionCard({ onClick }) {
      return (
        <div className="new-collection-card" onClick={onClick}>
          <div className="new-collection-icon">
            <PlusIcon />
          </div>
          <span className="new-collection-text">New Collection</span>
        </div>
      );
    }

    // ==========================================
    // CREATE/EDIT MODAL COMPONENT
    // ==========================================
    
    function CollectionModal({ 
      isOpen, 
      onClose, 
      onSave, 
      collection = null, 
      palette,
      parentId = null 
    }) {
      const [name, setName] = useState(collection?.name || '');
      const [description, setDescription] = useState(collection?.description || '');
      const [selectedColor, setSelectedColor] = useState(collection?.color || palette[0]?.hex);
      
      useEffect(() => {
        if (collection) {
          setName(collection.name || '');
          setDescription(collection.description || '');
          setSelectedColor(collection.color || palette[0]?.hex);
        } else {
          setName('');
          setDescription('');
          // Auto-assign next color in rotation
          setSelectedColor(palette[0]?.hex);
        }
      }, [collection, palette]);
      
      const handleSave = () => {
        if (!name.trim()) return;
        onSave({
          id: collection?.id,
          name: name.trim(),
          description: description.trim(),
          color: selectedColor,
          parent_id: parentId
        });
        onClose();
      };
      
      if (!isOpen) return null;
      
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal-content" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h2 className="modal-title">
                {collection ? 'Edit Collection' : 'New Collection'}
              </h2>
              <button 
                className="modal-info-btn"
                onClick={() => window.SocietyArts?.openInfoModal?.('collections-new')}
                title="Help"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
              </button>
            </div>
            
            <label className="modal-label">Name</label>
            <input 
              type="text"
              className="modal-input"
              placeholder="My Collection"
              value={name}
              onChange={e => setName(e.target.value)}
              autoFocus
              maxLength={50}
            />
            
            <label className="modal-label">Description (optional)</label>
            <input 
              type="text"
              className="modal-input"
              placeholder="A brief description..."
              value={description}
              onChange={e => setDescription(e.target.value)}
              maxLength={200}
            />
            
            <div className="color-picker">
              <label className="modal-label">Color</label>
              <div className="color-picker-grid">
                {palette.map(color => (
                  <div
                    key={color.id}
                    className={`color-picker-swatch ${selectedColor === color.hex ? 'selected' : ''}`}
                    style={{ backgroundColor: color.hex }}
                    onClick={() => setSelectedColor(color.hex)}
                    title={color.name}
                  />
                ))}
              </div>
            </div>
            
            <div className="modal-actions">
              <button className="btn btn-ghost" onClick={onClose}>
                Cancel
              </button>
              <button 
                className="btn btn-primary" 
                onClick={handleSave}
                disabled={!name.trim()}
              >
                {collection ? 'Save Changes' : 'Create'}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ==========================================
    // DELETE CONFIRMATION MODAL COMPONENT
    // ==========================================
    
    function DeleteConfirmationModal({ 
      isOpen, 
      onClose, 
      onConfirm, 
      collection,
      subCollectionCount = 0
    }) {
      const [step, setStep] = useState(1); // 1 = warning, 2 = type DELETE
      const [confirmText, setConfirmText] = useState('');
      
      // Reset state when modal opens/closes or collection changes
      useEffect(() => {
        if (isOpen) {
          setStep(1);
          setConfirmText('');
        }
      }, [isOpen, collection?.id]);
      
      if (!isOpen || !collection) return null;
      
      const hasSubCollections = subCollectionCount > 0;
      const styleCount = collection.styles?.length || 0;
      const isHighValue = styleCount > 0; // Collections with 1+ styles require extra confirmation
      const isDeleteMatch = confirmText === 'DELETE';
      
      const handleProceed = () => {
        if (isHighValue) {
          setStep(2);
        } else {
          onConfirm();
        }
      };
      
      const handleFinalDelete = () => {
        if (isDeleteMatch) {
          onConfirm();
        }
      };
      
      const handleClose = () => {
        setStep(1);
        setConfirmText('');
        onClose();
      };
      
      return (
        <div className="modal-overlay" onClick={handleClose}>
          <div className="delete-modal-content" onClick={e => e.stopPropagation()}>
            <div className="delete-modal-header">
              <div className="delete-modal-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M3 6h18"></path>
                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                </svg>
              </div>
              <button 
                className="modal-info-btn"
                onClick={() => window.SocietyArts?.openInfoModal?.('collections-delete')}
                title="Help"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
              </button>
            </div>
            
            <div className="delete-modal-body">
              {step === 1 ? (
                <>
                  <h3 className="delete-modal-title">Delete Collection?</h3>
                  
                  <p className="delete-modal-message">
                    You're about to delete <strong>{collection.name}</strong>.
                    {hasSubCollections && (
                      <> This will also remove {subCollectionCount} sub-collection{subCollectionCount !== 1 ? 's' : ''} inside it.</>
                    )}
                    {styleCount > 0 && (
                      <> This collection contains <strong>{styleCount} style{styleCount !== 1 ? 's' : ''}</strong>.</>
                    )}
                  </p>
                  
                  <div className="delete-modal-warning">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                      <line x1="12" y1="9" x2="12" y2="13"></line>
                      <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <p>This action cannot be undone. The styles saved in this collection will remain in your library, but the collection itself will be permanently removed.</p>
                  </div>
                  
                  <div className="delete-modal-actions">
                    <button className="btn btn-ghost" onClick={handleClose}>
                      Keep Collection
                    </button>
                    <button className="btn-delete" onClick={handleProceed}>
                      {isHighValue ? 'Continue' : 'Yes, Delete'}
                    </button>
                  </div>
                </>
              ) : (
                <>
                  <h3 className="delete-modal-title">Confirm Deletion</h3>
                  
                  <p className="delete-modal-message">
                    You're about to permanently delete <strong>{collection.name}</strong> and its {styleCount} saved style{styleCount !== 1 ? 's' : ''}.
                  </p>
                  
                  <div className="delete-confirm-input-wrapper">
                    <label className="delete-confirm-label">
                      Type <strong>DELETE</strong> to confirm
                    </label>
                    <input
                      type="text"
                      className={`delete-confirm-input ${isDeleteMatch ? 'valid' : ''}`}
                      placeholder="DELETE"
                      value={confirmText}
                      onChange={e => setConfirmText(e.target.value.toUpperCase())}
                      autoFocus
                      autoComplete="off"
                      spellCheck="false"
                    />
                  </div>
                  
                  <div className="delete-modal-actions">
                    <button className="btn btn-ghost" onClick={() => setStep(1)}>
                      Go Back
                    </button>
                    <button 
                      className="btn-delete" 
                      onClick={handleFinalDelete}
                      disabled={!isDeleteMatch}
                    >
                      Delete Forever
                    </button>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ==========================================
    // SHARE MODAL COMPONENT
    // ==========================================
    
    function ShareModal({ isOpen, onClose, collection }) {
      if (!isOpen || !collection) return null;
      
      const shareUrl = `${window.location.origin}/collections.html?id=${collection.id}`;
      const shareText = `Check out my collection "${collection.name}" on Society Arts`;
      
      const handleCopyLink = async () => {
        try {
          await navigator.clipboard.writeText(shareUrl);
          alert('Link copied to clipboard!');
        } catch (err) {
          // Fallback for older browsers
          const textarea = document.createElement('textarea');
          textarea.value = shareUrl;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          alert('Link copied to clipboard!');
        }
      };
      
      const handleEmailShare = () => {
        const subject = encodeURIComponent(`Check out my collection: ${collection.name}`);
        const body = encodeURIComponent(`${shareText}\n\n${shareUrl}`);
        window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
      };
      
      const handleTextShare = () => {
        // For mobile devices with SMS capability
        const body = encodeURIComponent(`${shareText} ${shareUrl}`);
        window.open(`sms:?body=${body}`, '_blank');
      };
      
      const handleTwitterShare = () => {
        const text = encodeURIComponent(shareText);
        const url = encodeURIComponent(shareUrl);
        window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank', 'width=550,height=420');
      };
      
      const handleFacebookShare = () => {
        const url = encodeURIComponent(shareUrl);
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=550,height=420');
      };
      
      const handlePinterestShare = () => {
        const url = encodeURIComponent(shareUrl);
        const description = encodeURIComponent(shareText);
        window.open(`https://pinterest.com/pin/create/button/?url=${url}&description=${description}`, '_blank', 'width=550,height=420');
      };
      
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="share-modal" onClick={e => e.stopPropagation()}>
            <div className="share-modal-header">
              <h3>Share Collection</h3>
              <button className="modal-close-btn" onClick={onClose}>
                <XIcon />
              </button>
            </div>
            
            <div className="share-modal-body">
              <p className="share-collection-name">{collection.name}</p>
              
              <div className="share-link-section">
                <label className="share-label">Collection Link</label>
                <div className="share-link-row">
                  <input 
                    type="text" 
                    className="share-link-input" 
                    value={shareUrl} 
                    readOnly 
                  />
                  <button className="btn btn-primary share-copy-btn" onClick={handleCopyLink}>
                    Copy
                  </button>
                </div>
              </div>
              
              <div className="share-options-section">
                <label className="share-label">Share via</label>
                <div className="share-options-grid">
                  <button className="share-option" onClick={handleEmailShare}>
                    <div className="share-option-icon email">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                      </svg>
                    </div>
                    <span>Email</span>
                  </button>
                  
                  <button className="share-option" onClick={handleTextShare}>
                    <div className="share-option-icon text">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                      </svg>
                    </div>
                    <span>Text</span>
                  </button>
                  
                  <button className="share-option" onClick={handleTwitterShare}>
                    <div className="share-option-icon twitter">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                      </svg>
                    </div>
                    <span>X</span>
                  </button>
                  
                  <button className="share-option" onClick={handleFacebookShare}>
                    <div className="share-option-icon facebook">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                      </svg>
                    </div>
                    <span>Facebook</span>
                  </button>
                  
                  <button className="share-option" onClick={handlePinterestShare}>
                    <div className="share-option-icon pinterest">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.632-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/>
                      </svg>
                    </div>
                    <span>Pinterest</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ==========================================
    // COLLECTION VIEW COMPONENT
    // ==========================================
    
    function CollectionView({ 
      collection, 
      subCollections, 
      palette, 
      onBack, 
      onEdit, 
      onDelete,
      onDuplicate,
      onShare,
      onCollectionClick,
      onCreateSubCollection,
      onRemoveStyle
    }) {
      const paletteColor = palette.find(c => c.hex === collection.color) || palette[0];
      const styles = collection.styles || [];
      const styleCount = styles.length;
      const subCount = subCollections.length;
      
      let metaText = '';
      if (subCount > 0 && styleCount > 0) {
        metaText = `${subCount} sub-collection${subCount !== 1 ? 's' : ''} Â· ${styleCount} style${styleCount !== 1 ? 's' : ''}`;
      } else if (subCount > 0) {
        metaText = `${subCount} sub-collection${subCount !== 1 ? 's' : ''}`;
      } else {
        metaText = `${styleCount} style${styleCount !== 1 ? 's' : ''}`;
      }
      
      const getStyleThumbnail = (styleId) => {
        // Use the proper thumbnail URL helper or fallback to correct pattern
        return window.SocietyArts?.getStyleThumbnailUrl?.(styleId, 0) || 
               window.SocietyArts?.getAltStyleThumbnailUrl?.(styleId) ||
               `https://pub-acb560f551f141db830964aed1fa005f.r2.dev/${styleId}/${styleId}-00.webp`;
      };
      
      const handleStyleClick = (styleId) => {
        // Open the shared style detail modal with collection context
        if (window.SocietyArts?.openStyleDetailModal) {
          window.SocietyArts.openStyleDetailModal(styleId, {
            collectionId: collection.id,
            collectionName: collection.name,
            onRemove: (removedStyleId) => {
              // Refresh the page to show updated collection
              window.location.reload();
            }
          });
        } else {
          console.error('Style Detail Modal not loaded');
        }
      };
      
      return (
        <>
          {/* Back Navigation */}
          <div className="collections-back-nav">
            <button className="collections-back-btn" onClick={onBack}>
              <ChevronLeftIcon />
              Back
            </button>
          </div>
          
          {/* Collection Header */}
          <div className="collection-header">
            <div className="collection-header-info">
              <h1 className="collection-header-title">{collection.name}</h1>
              <p className="collection-header-meta">{metaText}</p>
              {collection.description && (
                <p className="collections-subtitle">{collection.description}</p>
              )}
              <div className="collection-header-actions">
                <button className="collection-action-btn" onClick={() => onEdit(collection)}>
                  Edit
                </button>
                <button className="collection-action-btn danger" onClick={() => onDelete(collection)}>
                  Delete
                </button>
              </div>
            </div>
            <div 
              className="collection-header-color"
              style={{ backgroundColor: collection.color }}
            />
          </div>
          
          {/* Sub-collections */}
          {(subCollections.length > 0 || true) && (
            <>
              <h4 className="collections-section-header">Sub-collections</h4>
              <div className="collections-grid">
                <NewCollectionCard onClick={onCreateSubCollection} />
                {subCollections.map(sub => (
                  <CollectionCard 
                    key={sub.id}
                    collection={sub}
                    palette={palette}
                    onClick={onCollectionClick}
                    onEdit={onEdit}
                    onDelete={onDelete}
                    onDuplicate={onDuplicate}
                    onShare={onShare}
                  />
                ))}
              </div>
            </>
          )}
          
          {/* Styles */}
          <h4 className="collections-section-header">Styles in this collection</h4>
          <div className="styles-grid">
            {styles.map(styleId => (
              <div key={styleId} className="style-thumbnail" onClick={() => handleStyleClick(styleId)}>
                <img 
                  src={getStyleThumbnail(styleId)} 
                  alt={styleId}
                  onError={e => e.target.style.opacity = 0.3}
                />
                <button 
                  className="style-thumbnail-remove"
                  onClick={(e) => {
                    e.stopPropagation();
                    onRemoveStyle(collection.id, styleId);
                  }}
                  title="Remove from collection"
                >
                  <XIcon />
                </button>
              </div>
            ))}
            <div className="add-style-card" onClick={() => window.location.href = '/style-finder.html'}>
              <PlusIcon />
              <span>Add Styles</span>
            </div>
          </div>
        </>
      );
    }

    // ==========================================
    // MAIN COLLECTIONS PAGE COMPONENT
    // ==========================================
    
    function CollectionsPage() {
      const { Header, Sidebar } = window.SocietyArts || {};
      
      if (!Sidebar || !Header) {
        return React.createElement('div', { className: 'loading-state' }, 'Loading...');
      }
      
      const { user, profile, isLoading: authLoading } = window.SocietyArts.useAuth();
      const [collections, setCollections] = useState([]);
      const [palette, setPalette] = useState(DEFAULT_PALETTE);
      const [isLoading, setIsLoading] = useState(true);
      const [authModalOpen, setAuthModalOpen] = useState(false);
      const [createModalOpen, setCreateModalOpen] = useState(false);
      const [editingCollection, setEditingCollection] = useState(null);
      const [currentView, setCurrentView] = useState(null); // null = root, or collection object
      const [breadcrumbs, setBreadcrumbs] = useState([]);
      const [createParentId, setCreateParentId] = useState(null);
      const [deleteModalOpen, setDeleteModalOpen] = useState(false);
      const [collectionToDelete, setCollectionToDelete] = useState(null);
      const [shareModalOpen, setShareModalOpen] = useState(false);
      const [collectionToShare, setCollectionToShare] = useState(null);

      // Get Supabase client
      const getSupabase = () => {
        return window.SocietyArts?.supabase || window.supabaseClient || window.supabase;
      };

      // Load palette from admin_settings
      useEffect(() => {
        const loadPalette = async () => {
          try {
            const supabase = getSupabase();
            if (!supabase?.from) {
              console.log('Supabase client not ready, using default palette');
              return;
            }
            const { data, error } = await supabase
              .from('admin_settings')
              .select('value')
              .eq('key', 'collection_palette')
              .single();
            
            if (data?.value?.colors) {
              setPalette(data.value.colors);
            }
          } catch (err) {
            console.log('Using default palette');
          }
        };
        loadPalette();
      }, []);

      // Load collections
      const loadCollections = useCallback(async () => {
        if (!user) return;
        
        setIsLoading(true);
        try {
          const supabase = getSupabase();
          if (!supabase?.from) {
            console.error('Supabase client not available');
            setIsLoading(false);
            return;
          }
          
          const { data, error } = await supabase
            .from('user_collections')
            .select('*')
            .eq('user_id', user.id)
            .order('sort_order', { ascending: true })
            .order('created_at', { ascending: false });
          
          if (error) throw error;
          
          // Calculate subcollection counts
          const withCounts = (data || []).map(col => ({
            ...col,
            subcollection_count: (data || []).filter(c => c.parent_id === col.id).length
          }));
          
          setCollections(withCounts);
        } catch (err) {
          console.error('Error loading collections:', err);
        } finally {
          setIsLoading(false);
        }
      }, [user]);

      useEffect(() => {
        if (user) {
          loadCollections();
        }
      }, [user, loadCollections]);

      // Get root collections (no parent)
      const rootCollections = collections.filter(c => !c.parent_id);
      
      // Get sub-collections for current view
      const getSubCollections = (parentId) => {
        return collections.filter(c => c.parent_id === parentId);
      };

      // Handle create/update collection
      const handleSaveCollection = async (collectionData) => {
        try {
          const supabase = getSupabase();
          if (!supabase?.from) {
            throw new Error('Supabase client not available');
          }
          
          if (collectionData.id) {
            // Update existing
            const { error } = await supabase
              .from('user_collections')
              .update({
                name: collectionData.name,
                description: collectionData.description,
                color: collectionData.color,
                updated_at: new Date().toISOString()
              })
              .eq('id', collectionData.id)
              .eq('user_id', user.id);
            
            if (error) throw error;
            
            // Update currentView if we're editing the currently viewed collection
            if (currentView?.id === collectionData.id) {
              setCurrentView(prev => ({
                ...prev,
                name: collectionData.name,
                description: collectionData.description,
                color: collectionData.color
              }));
            }
          } else {
            // Create new
            const { error } = await supabase
              .from('user_collections')
              .insert({
                user_id: user.id,
                name: collectionData.name,
                description: collectionData.description,
                color: collectionData.color,
                parent_id: collectionData.parent_id,
                styles: []
              });
            
            if (error) throw error;
          }
          
          await loadCollections();
          setEditingCollection(null);
          setCreateParentId(null);
        } catch (err) {
          console.error('Error saving collection:', err);
          alert('Failed to save collection. Please try again.');
        }
      };

      // Handle delete collection - opens confirmation modal
      const handleDeleteCollection = (collection) => {
        setCollectionToDelete(collection);
        setDeleteModalOpen(true);
      };

      // Confirm delete - actually performs the deletion
      const confirmDeleteCollection = async () => {
        if (!collectionToDelete) return;
        
        try {
          const supabase = getSupabase();
          if (!supabase?.from) {
            throw new Error('Supabase client not available');
          }
          
          const { error } = await supabase
            .from('user_collections')
            .delete()
            .eq('id', collectionToDelete.id);
          
          if (error) throw error;
          
          await loadCollections();
          
          // If we deleted the current view, go back
          if (currentView?.id === collectionToDelete.id) {
            handleBack();
          }
          
          // Close modal and reset state
          setDeleteModalOpen(false);
          setCollectionToDelete(null);
        } catch (err) {
          console.error('Error deleting collection:', err);
          alert('Failed to delete collection. Please try again.');
        }
      };

      // Get sub-collection count for delete modal
      const getSubCollectionCount = (collection) => {
        if (!collection) return 0;
        return collections.filter(c => c.parent_id === collection.id).length;
      };

      // Handle edit collection - opens edit modal
      const handleEditCollection = (collection) => {
        setEditingCollection(collection);
        setCreateModalOpen(true);
      };

      // Handle duplicate collection
      const handleDuplicateCollection = async (collection) => {
        try {
          const supabase = getSupabase();
          const user = window.AuthState?.user;
          
          if (!supabase?.from || !user) {
            throw new Error('Not authenticated');
          }
          
          // Create new collection with "Copy of" prefix
          const { data: newCollection, error: createError } = await supabase
            .from('user_collections')
            .insert({
              user_id: user.id,
              name: `Copy of ${collection.name}`,
              description: collection.description,
              color: collection.color,
              parent_id: collection.parent_id
            })
            .select()
            .single();
          
          if (createError) throw createError;
          
          // Copy all styles to the new collection
          if (collection.styles && collection.styles.length > 0) {
            const styleInserts = collection.styles.map(styleId => ({
              collection_id: newCollection.id,
              style_id: styleId
            }));
            
            const { error: stylesError } = await supabase
              .from('collection_styles')
              .insert(styleInserts);
            
            if (stylesError) console.error('Error copying styles:', stylesError);
          }
          
          await loadCollections();
        } catch (err) {
          console.error('Error duplicating collection:', err);
          alert('Failed to duplicate collection. Please try again.');
        }
      };

      // Handle share collection - opens share modal
      const handleShareCollection = (collection) => {
        setCollectionToShare(collection);
        setShareModalOpen(true);
      };

      // Handle collection click
      const handleCollectionClick = (collection) => {
        setBreadcrumbs(prev => [...prev, currentView].filter(Boolean));
        setCurrentView(collection);
      };

      // Handle back navigation
      const handleBack = () => {
        const prevView = breadcrumbs[breadcrumbs.length - 1] || null;
        setBreadcrumbs(prev => prev.slice(0, -1));
        setCurrentView(prevView);
      };

      // Handle create sub-collection
      const handleCreateSubCollection = () => {
        setCreateParentId(currentView?.id || null);
        setCreateModalOpen(true);
      };

      // Handle remove style from collection
      const handleRemoveStyle = async (collectionId, styleId) => {
        try {
          const supabase = getSupabase();
          if (!supabase?.from) {
            throw new Error('Supabase client not available');
          }
          
          const collection = collections.find(c => c.id === collectionId);
          if (!collection) return;
          
          const updatedStyles = (collection.styles || []).filter(s => s !== styleId);
          
          const { error } = await supabase
            .from('user_collections')
            .update({ 
              styles: updatedStyles,
              updated_at: new Date().toISOString()
            })
            .eq('id', collectionId);
          
          if (error) throw error;
          
          await loadCollections();
          
          // Update current view if we're viewing this collection
          if (currentView?.id === collectionId) {
            setCurrentView(prev => ({ ...prev, styles: updatedStyles }));
          }
        } catch (err) {
          console.error('Error removing style:', err);
        }
      };

      // Build breadcrumb path
      const buildBreadcrumbPath = () => {
        const path = [{ name: 'Collections', onClick: () => { setCurrentView(null); setBreadcrumbs([]); }}];
        
        breadcrumbs.forEach((crumb, index) => {
          if (crumb) {
            path.push({
              name: crumb.name,
              onClick: () => {
                setBreadcrumbs(prev => prev.slice(0, index));
                setCurrentView(crumb);
              }
            });
          }
        });
        
        if (currentView) {
          path.push({ name: currentView.name, onClick: null });
        }
        
        return path;
      };

      const AuthModal = window.SocietyArts?.AuthModal;

      return (
        <div className="page-container">
          <Sidebar />
          <Header user={user} profile={profile} />
          
          <main className="collections-content">
            {/* Breadcrumb */}
            <div className="collections-breadcrumb">
              <a href="index.html">Home</a>
              <ChevronRightIcon />
              {buildBreadcrumbPath().map((crumb, index, arr) => (
                <React.Fragment key={index}>
                  {crumb.onClick ? (
                    <a href="#" onClick={e => { e.preventDefault(); crumb.onClick(); }}>
                      {crumb.name}
                    </a>
                  ) : (
                    <span>{crumb.name}</span>
                  )}
                  {index < arr.length - 1 && <ChevronRightIcon />}
                </React.Fragment>
              ))}
            </div>
            
            {/* Page Header (only on root view) */}
            {!currentView && (
              <div className="collections-header">
                <h1 className="collections-title">Collections</h1>
                <p className="collections-subtitle">Organize and save your favorite art styles</p>
              </div>
            )}
            
            {/* Main Content */}
            {authLoading || isLoading ? (
              <div className="loading-state">Loading...</div>
            ) : !user ? (
              <div className="login-prompt">
                <h2>Sign in to view your collections</h2>
                <p>Create collections to organize your favorite styles into groups.</p>
                <button 
                  className="btn btn-primary"
                  onClick={() => setAuthModalOpen(true)}
                >
                  Sign In
                </button>
              </div>
            ) : currentView ? (
              // Collection Detail View
              <CollectionView
                collection={currentView}
                subCollections={getSubCollections(currentView.id)}
                palette={palette}
                onBack={handleBack}
                onEdit={handleEditCollection}
                onDelete={handleDeleteCollection}
                onDuplicate={handleDuplicateCollection}
                onShare={handleShareCollection}
                onCollectionClick={handleCollectionClick}
                onCreateSubCollection={handleCreateSubCollection}
                onRemoveStyle={handleRemoveStyle}
              />
            ) : rootCollections.length === 0 ? (
              // Empty State
              <div className="empty-state">
                <div className="empty-icon">
                  <LayersIcon />
                </div>
                <h2 className="empty-title">No collections yet</h2>
                <p className="empty-text">
                  Create your first collection to start organizing styles into meaningful groups.
                </p>
                <button 
                  className="btn btn-primary"
                  onClick={() => setCreateModalOpen(true)}
                >
                  Create Collection
                </button>
              </div>
            ) : (
              // Root Collections Grid
              <div className="collections-grid">
                <NewCollectionCard onClick={() => setCreateModalOpen(true)} />
                {rootCollections.map(collection => (
                  <CollectionCard 
                    key={collection.id}
                    collection={collection}
                    palette={palette}
                    onClick={handleCollectionClick}
                    onEdit={handleEditCollection}
                    onDelete={handleDeleteCollection}
                    onDuplicate={handleDuplicateCollection}
                    onShare={handleShareCollection}
                  />
                ))}
              </div>
            )}
          </main>
          
          {/* Auth Modal */}
          {authModalOpen && AuthModal && (
            <AuthModal 
              isOpen={authModalOpen}
              onClose={() => setAuthModalOpen(false)}
            />
          )}
          
          {/* Create/Edit Modal */}
          <CollectionModal
            isOpen={createModalOpen || !!editingCollection}
            onClose={() => {
              setCreateModalOpen(false);
              setEditingCollection(null);
              setCreateParentId(null);
            }}
            onSave={handleSaveCollection}
            collection={editingCollection}
            palette={palette}
            parentId={createParentId}
          />
          
          {/* Delete Confirmation Modal */}
          <DeleteConfirmationModal
            isOpen={deleteModalOpen}
            onClose={() => {
              setDeleteModalOpen(false);
              setCollectionToDelete(null);
            }}
            onConfirm={confirmDeleteCollection}
            collection={collectionToDelete}
            subCollectionCount={getSubCollectionCount(collectionToDelete)}
          />
          
          {/* Share Modal */}
          <ShareModal
            isOpen={shareModalOpen}
            onClose={() => {
              setShareModalOpen(false);
              setCollectionToShare(null);
            }}
            collection={collectionToShare}
          />
        </div>
      );
    }

    // ==========================================
    // INITIALIZE APP
    // ==========================================
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    
    function waitForComponents(callback, maxAttempts = 50) {
      let attempts = 0;
      const check = () => {
        attempts++;
        const hasComponents = window.SocietyArts?.Sidebar && window.SocietyArts?.Header && window.SocietyArts?.useAuth;
        const hasSupabase = window.SocietyArts?.supabase?.from || window.supabaseClient?.from || window.supabase?.from;
        
        if (hasComponents && hasSupabase) {
          callback();
        } else if (attempts < maxAttempts) {
          setTimeout(check, 100);
        } else {
          console.error('Components or Supabase failed to load');
          callback();
        }
      };
      check();
    }
    
    waitForComponents(() => {
      root.render(<CollectionsPage />);
    });
  </script>
</body>
</html>
