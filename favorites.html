<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Favorites - Society Arts</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://pub-acb560f551f141db830964aed1fa005f.r2.dev/site-assets/SA_Monogram_Black%401x%201x1.png">
  
  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/shared/supabase-client.js"></script>
  
  <!-- Fonts - Familjen Grotesk + Domine -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;500;600;700&family=Familjen+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/variables.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/help-modals.css">
  
  <style>
    .favorites-content {
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-2xl);
      width: 100%;
    }
    
    .favorites-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-2xl);
    }
    
    .favorites-title {
      font-family: var(--font-serif);
      font-size: var(--text-3xl);
      font-weight: var(--weight-normal);
      margin: 0;
    }
    
    .favorites-count {
      color: var(--color-text-muted);
      font-size: var(--text-lg);
      margin-left: var(--space-md);
    }
    
    /* Table View */
    .favorites-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .favorites-table th {
      text-align: left;
      padding: var(--space-md) var(--space-lg);
      border-bottom: 2px solid var(--color-border);
      font-weight: var(--weight-semibold);
      font-size: var(--text-sm);
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .favorites-table td {
      padding: var(--space-md) var(--space-lg);
      border-bottom: 1px solid var(--color-border);
      vertical-align: middle;
    }
    
    .favorites-table tr:hover {
      background: var(--color-surface-alt);
    }
    
    .favorites-table tbody tr {
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .favorite-thumbnail {
      width: 60px;
      height: 60px;
      border-radius: var(--radius-md);
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .favorite-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .style-id-cell {
      font-family: monospace;
      font-size: var(--text-sm);
      color: var(--color-text-muted);
    }
    
    .style-name-cell {
      font-weight: var(--weight-medium);
    }
    
    .date-cell {
      font-size: var(--text-sm);
      color: var(--color-text-muted);
    }
    
    .action-cell {
      text-align: right;
    }
    
    .favorite-heart {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: transparent;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #dc2626;
      transition: all 0.2s;
    }
    
    .favorite-heart:hover {
      background: #fee2e2;
      transform: scale(1.1);
    }
    
    .loading-state {
      text-align: center;
      padding: var(--space-5xl);
      color: var(--color-text-muted);
    }
    
    /* === Favorites Explainer (What are Favorites) === */
    .favorites-explainer {
      max-width: 800px;
      padding: var(--space-xl) 0;
    }
    
    .explainer-header {
      margin-bottom: var(--space-2xl);
    }
    
    .explainer-title {
      font-family: var(--font-serif);
      font-size: clamp(28px, 4vw, 36px);
      font-weight: 500;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-sm) 0;
    }
    
    .explainer-subtitle {
      font-size: 16px;
      color: var(--color-text-muted);
      line-height: 1.6;
      margin: 0;
    }
    
    /* Analogy Section */
    .explainer-analogy {
      background: white;
      border: 1px solid var(--color-border-light);
      border-radius: 16px;
      padding: var(--space-2xl);
      margin-bottom: var(--space-2xl);
    }
    
    .analogy-header {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }
    
    .analogy-icon {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-tan-10);
      border-radius: 12px;
      color: var(--color-accent);
    }
    
    .analogy-icon svg {
      width: 28px;
      height: 28px;
    }
    
    .analogy-title {
      font-family: var(--font-serif);
      font-size: 20px;
      font-weight: 600;
      color: var(--color-text-primary);
      margin: 0;
    }
    
    .analogy-text {
      font-size: 15px;
      color: var(--color-text-secondary);
      line-height: 1.7;
      margin: 0;
    }
    
    /* Formula Section */
    .explainer-formula {
      background: var(--color-tan-10);
      border-radius: 16px;
      padding: var(--space-2xl);
      margin-bottom: var(--space-2xl);
    }
    
    .formula-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-lg);
      flex-wrap: wrap;
    }
    
    .formula-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .formula-icon {
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border-radius: 14px;
      color: var(--color-text-primary);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }
    
    .formula-icon svg {
      width: 32px;
      height: 32px;
    }
    
    .formula-label {
      font-weight: 600;
      font-size: 13px;
      color: var(--color-text-secondary);
    }
    
    .formula-operator {
      font-family: var(--font-serif);
      font-size: 28px;
      color: var(--color-text-light);
    }
    
    .formula-result-icon {
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-accent);
      border-radius: 14px;
      color: white;
      box-shadow: 0 4px 12px rgba(192, 113, 91, 0.3);
    }
    
    .formula-result-icon svg {
      width: 32px;
      height: 32px;
    }
    
    /* Benefits Section */
    .explainer-benefits {
      margin-bottom: var(--space-2xl);
    }
    
    .benefits-title {
      font-family: var(--font-serif);
      font-size: 18px;
      font-weight: 600;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-lg) 0;
    }
    
    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-lg);
    }
    
    .benefit-card {
      background: white;
      border: 1px solid var(--color-border-light);
      border-radius: 12px;
      padding: var(--space-lg);
    }
    
    .benefit-icon {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-tan-10);
      border-radius: 10px;
      color: var(--color-accent);
      margin-bottom: var(--space-md);
    }
    
    .benefit-icon svg {
      width: 22px;
      height: 22px;
    }
    
    .benefit-title {
      font-weight: 600;
      font-size: 15px;
      color: var(--color-text-primary);
      margin: 0 0 var(--space-xs) 0;
    }
    
    .benefit-text {
      font-size: 13px;
      color: var(--color-text-muted);
      line-height: 1.5;
      margin: 0;
    }
    
    /* CTA Section */
    .explainer-cta {
      background: var(--color-text-primary);
      border-radius: 16px;
      padding: var(--space-2xl);
      text-align: center;
    }
    
    .cta-title {
      font-family: var(--font-serif);
      font-size: 24px;
      color: white;
      margin: 0 0 var(--space-sm) 0;
    }
    
    .cta-text {
      font-size: 15px;
      color: rgba(255, 255, 255, 0.7);
      margin: 0 0 var(--space-xl) 0;
    }
    
    .cta-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      background: var(--color-accent);
      color: white;
      border: none;
      border-radius: 100px;
      font-family: var(--font-sans);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    
    .cta-button:hover {
      background: #a85d45;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(192, 113, 91, 0.4);
    }
    
    .cta-button svg {
      width: 18px;
      height: 18px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .favorites-table th:nth-child(1),
      .favorites-table td:nth-child(1) {
        display: none;
      }
    }
    
    @media (max-width: 600px) {
      .formula-row {
        flex-direction: column;
        gap: var(--space-md);
      }
      
      .formula-operator {
        transform: rotate(90deg);
      }
      
      .benefits-grid {
        grid-template-columns: 1fr;
      }
      
      .explainer-analogy,
      .explainer-formula,
      .explainer-cta {
        padding: var(--space-xl);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- Shared Components -->
  <script src="/js/shared/api.js"></script>
  <script src="/js/shared/auth.js"></script>
  <script src="/js/shared/projects.js"></script>
  <script src="/js/shared/header.js"></script>
  <script src="/js/style-finder/style-data.js"></script>
  
  <!-- Favorites App - No JSX, uses React.createElement -->
  <script>
    (function() {
      const { useState, useEffect, createElement: h } = React;

      // ==========================================
      // SVG ICONS (as innerHTML strings)
      // ==========================================
      
      const Icons = {
        heart: '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
        heartFilled: '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
        search: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
        click: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 15l-2 5L9 9l11 4-5 2z"></path><path d="M22 22L15 15"></path></svg>',
        star: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',
        bookmark: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>',
        clock: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',
        grid: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>',
        arrowRight: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>'
      };
      
      // Helper to create element with innerHTML for SVG icons
      function icon(iconHtml) {
        return h('span', { dangerouslySetInnerHTML: { __html: iconHtml } });
      }

      // ==========================================
      // FAVORITES EXPLAINER COMPONENT
      // ==========================================
      
      function FavoritesExplainer(props) {
        var isLoggedIn = props.isLoggedIn;
        var onSignInClick = props.onSignInClick;
        
        return h('div', { className: 'favorites-explainer' },
          // Header
          h('div', { className: 'explainer-header' },
            h('h1', { className: 'explainer-title' }, 'Your Favorites'),
            h('p', { className: 'explainer-subtitle' },
              isLoggedIn 
                ? "Save art styles you love and access them anytime. Your favorites are always just a click away."
                : "Sign in to start saving your favorite art styles. Build a personal gallery of inspiration that's always at your fingertips."
            )
          ),
          
          // Analogy Section
          h('div', { className: 'explainer-analogy' },
            h('div', { className: 'analogy-header' },
              h('div', { className: 'analogy-icon' }, icon(Icons.heart)),
              h('h2', { className: 'analogy-title' }, 'Like bookmarking your favorite pages')
            ),
            h('p', { className: 'analogy-text' },
              "Found an art style that speaks to you? Click the heart icon to save it to your favorites. Just like bookmarking a website, your favorites let you quickly return to styles you want to explore further, compare, or use for your next project. No more scrolling through thousands of styles to find that one perfect match."
            )
          ),
          
          // Formula / How It Works
          h('div', { className: 'explainer-formula' },
            h('div', { className: 'formula-row' },
              h('div', { className: 'formula-item' },
                h('div', { className: 'formula-icon' }, icon(Icons.search)),
                h('span', { className: 'formula-label' }, 'Browse Styles')
              ),
              h('span', { className: 'formula-operator' }, '+'),
              h('div', { className: 'formula-item' },
                h('div', { className: 'formula-icon' }, icon(Icons.click)),
                h('span', { className: 'formula-label' }, 'Click the Heart')
              ),
              h('span', { className: 'formula-operator' }, '='),
              h('div', { className: 'formula-item' },
                h('div', { className: 'formula-result-icon' }, icon(Icons.star)),
                h('span', { className: 'formula-label' }, 'Saved Forever')
              )
            )
          ),
          
          // Benefits
          h('div', { className: 'explainer-benefits' },
            h('h3', { className: 'benefits-title' }, 'Why use Favorites?'),
            h('div', { className: 'benefits-grid' },
              h('div', { className: 'benefit-card' },
                h('div', { className: 'benefit-icon' }, icon(Icons.bookmark)),
                h('h4', { className: 'benefit-title' }, 'Quick Access'),
                h('p', { className: 'benefit-text' }, 'Jump straight to styles you love without searching through thousands of options.')
              ),
              h('div', { className: 'benefit-card' },
                h('div', { className: 'benefit-icon' }, icon(Icons.clock)),
                h('h4', { className: 'benefit-title' }, 'Save Time'),
                h('p', { className: 'benefit-text' }, 'Build a shortlist of styles for projects and make decisions faster.')
              ),
              h('div', { className: 'benefit-card' },
                h('div', { className: 'benefit-icon' }, icon(Icons.grid)),
                h('h4', { className: 'benefit-title' }, 'Compare Easily'),
                h('p', { className: 'benefit-text' }, 'See all your favorites in one place to compare and choose the perfect style.')
              )
            )
          ),
          
          // CTA
          h('div', { className: 'explainer-cta' },
            h('h3', { className: 'cta-title' },
              isLoggedIn ? "Start Building Your Collection" : "Ready to Save Your Favorites?"
            ),
            h('p', { className: 'cta-text' },
              isLoggedIn 
                ? "Explore our library of art styles and click the heart to save your favorites."
                : "Sign in to start saving styles and create your personal inspiration gallery."
            ),
            isLoggedIn 
              ? h('a', { href: '/style-finder.html', className: 'cta-button' },
                  'Browse Styles',
                  icon(Icons.arrowRight)
                )
              : h('button', { className: 'cta-button', onClick: onSignInClick },
                  'Sign In to Start',
                  icon(Icons.arrowRight)
                )
          )
        );
      }

      // ==========================================
      // MAIN FAVORITES PAGE COMPONENT
      // ==========================================

      function FavoritesPage() {
        // Get shared components
        var SA = window.SocietyArts || {};
        var Header = SA.Header;
        var Sidebar = SA.Sidebar;
        var Footer = SA.Footer;
        var AuthModal = SA.AuthModal;
        
        // Loading check - wait for components
        if (!Sidebar || !Header) {
          return h('div', { className: 'loading-state' }, 'Loading...');
        }
        
        // Auth state
        var authHook = SA.useAuth ? SA.useAuth() : {};
        var user = authHook.user;
        var authLoading = authHook.isLoading;
        
        // Favorites state - use the hook
        var favoritesHook = SA.useFavorites ? SA.useFavorites() : {};
        var favorites = favoritesHook.favorites || [];
        var favoritesLoading = favoritesHook.isLoading;
        
        // Local state
        var _stylesState = useState([]);
        var styles = _stylesState[0];
        var setStyles = _stylesState[1];
        
        var _loadingState = useState(true);
        var isLoading = _loadingState[0];
        var setIsLoading = _loadingState[1];
        
        var _authModalState = useState(false);
        var authModalOpen = _authModalState[0];
        var setAuthModalOpen = _authModalState[1];

        // Load style details when favorites change
        useEffect(function() {
          if (!user) {
            setIsLoading(false);
            return;
          }
          
          if (favoritesLoading) {
            return;
          }
          
          if (favorites.length === 0) {
            setStyles([]);
            setIsLoading(false);
            return;
          }
          
          // Get style IDs from favorites
          var favoriteIds = favorites.map(function(f) { return f.style_id; }).filter(Boolean);
          
          if (favoriteIds.length === 0) {
            setStyles([]);
            setIsLoading(false);
            return;
          }
          
          // Load style details from database
          setIsLoading(true);
          SA.supabase
            .from('styles')
            .select('id, name, image_urls')
            .in('id', favoriteIds)
            .then(function(result) {
              var data = result.data;
              if (data) {
                // Merge style data with favorite data (for dates)
                var stylesWithDates = data.map(function(style) {
                  var fav = favorites.find(function(f) { return f.style_id === style.id; });
                  return {
                    id: style.id,
                    name: style.name,
                    image_urls: style.image_urls,
                    created_at: fav ? fav.created_at : null
                  };
                });
                setStyles(stylesWithDates);
              }
              setIsLoading(false);
            })
            .catch(function(err) {
              console.error('Error loading styles:', err);
              setIsLoading(false);
            });
            
        }, [user, favorites, favoritesLoading]);

        // Handle remove favorite
        function handleRemoveFavorite(e, styleId) {
          e.stopPropagation();
          if (SA.removeFavorite) {
            SA.removeFavorite(styleId).then(function() {
              setStyles(function(prev) {
                return prev.filter(function(s) { return s.id !== styleId; });
              });
            });
          }
        }

        // Handle style click
        function handleStyleClick(styleId) {
          window.location.href = '/style-finder.html?style=' + styleId;
        }

        // Get style image URL
        function getStyleImage(styleId) {
          var style = styles.find(function(s) { return s.id === styleId; });
          if (style && style.image_urls && style.image_urls.length > 0) {
            return style.image_urls[0];
          }
          return SA.getAltStyleThumbnailUrl ? SA.getAltStyleThumbnailUrl(styleId) : '';
        }

        // Format date
        function formatDate(dateString) {
          if (!dateString) return '-';
          var date = new Date(dateString);
          return date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric',
            year: 'numeric'
          });
        }

        // Determine what to show
        var showLoading = authLoading || (user && isLoading);
        var showExplainer = !showLoading && (!user || (user && styles.length === 0));
        var showTable = !showLoading && user && styles.length > 0;

        // Build table rows
        var tableRows = styles.map(function(style) {
          return h('tr', { 
            key: style.id,
            onClick: function() { handleStyleClick(style.id); }
          },
            h('td', null,
              h('div', { className: 'favorite-thumbnail' },
                h('img', {
                  loading: 'lazy',
                  src: getStyleImage(style.id),
                  alt: style.name,
                  onError: function(e) {
                    if (SA.getAltStyleThumbnailUrl) {
                      e.target.src = SA.getAltStyleThumbnailUrl(style.id);
                    }
                  }
                })
              )
            ),
            h('td', { className: 'style-id-cell' }, style.id),
            h('td', { className: 'style-name-cell' }, style.name),
            h('td', { className: 'date-cell' }, formatDate(style.created_at)),
            h('td', { className: 'action-cell' },
              h('button', {
                className: 'favorite-heart',
                onClick: function(e) { handleRemoveFavorite(e, style.id); },
                title: 'Remove from favorites'
              }, icon(Icons.heartFilled))
            )
          );
        });

        return h('div', { className: 'page-container' },
          h(Sidebar, null),
          h(Header, null),
          
          h('main', { className: 'main-content favorites-content' },
            showLoading 
              ? h('div', { className: 'loading-state' }, 'Loading...')
              : showExplainer
                ? h(FavoritesExplainer, {
                    isLoggedIn: !!user,
                    onSignInClick: function() { setAuthModalOpen(true); }
                  })
                : showTable
                  ? h(React.Fragment, null,
                      h('div', { className: 'favorites-header' },
                        h('h1', { className: 'favorites-title' },
                          'My Favorites',
                          h('span', { className: 'favorites-count' }, '(' + styles.length + ')')
                        )
                      ),
                      h('table', { className: 'favorites-table' },
                        h('thead', null,
                          h('tr', null,
                            h('th', { style: { width: '80px' } }),
                            h('th', null, 'Style ID'),
                            h('th', null, 'Title'),
                            h('th', null, 'Date Added'),
                            h('th', { style: { width: '60px' } })
                          )
                        ),
                        h('tbody', null, tableRows)
                      )
                    )
                  : null
          ),
          
          h(Footer, null),
          
          // Auth Modal
          AuthModal && h(AuthModal, {
            isOpen: authModalOpen,
            onClose: function() { setAuthModalOpen(false); }
          })
        );
      }

      // ==========================================
      // RENDER
      // ==========================================
      
      var root = ReactDOM.createRoot(document.getElementById('root'));
      
      function waitForComponents(callback, maxAttempts) {
        maxAttempts = maxAttempts || 50;
        var attempts = 0;
        
        function check() {
          attempts++;
          var SA = window.SocietyArts;
          if (SA && SA.Sidebar && SA.Header && SA.useAuth) {
            // Initialize auth before rendering
            if (window.initializeAuth && (!window.AuthState || !window.AuthState.initialized)) {
              window.initializeAuth().then(callback);
            } else {
              callback();
            }
          } else if (attempts < maxAttempts) {
            setTimeout(check, 100);
          } else {
            console.error('Components failed to load');
            callback();
          }
        }
        check();
      }
      
      waitForComponents(function() {
        root.render(h(FavoritesPage, null));
      });
      
    })();
  </script>
</body>
</html>
