<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Style Finder | Society Arts</title>
    <link rel="icon" href="https://www.societyarts.com/favicon.ico">
    <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/1faad8_7f73e4942b38480e99f40af7799c767d~mv2.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/modals.css">
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Style Finder Page Specific Styles */
        .style-finder-page {
            display: flex;
            height: 100vh;
            padding-top: 60px;
        }
        
        /* Sidebar */
        .filter-sidebar {
            width: 280px;
            background: var(--color-surface, #fff);
            border-right: 1px solid var(--color-border, #e5e5e5);
            overflow-y: auto;
            padding: 1rem;
            flex-shrink: 0;
            height: calc(100vh - 60px);
            position: sticky;
            top: 60px;
        }
        
        /* Reset/Apply Buttons at bottom of sidebar */
        .filter-actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1rem 0;
            border-top: 1px solid var(--color-border, #e5e5e5);
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .filter-actions .reset-btn {
            flex: 1;
            padding: 0.625rem 1rem;
            background: var(--color-surface, #f5f5f5);
            border: 1px solid var(--color-border, #ddd);
            border-radius: 24px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-secondary, #666);
            transition: all 0.2s;
        }
        
        .filter-actions .reset-btn:hover {
            background: var(--color-border, #e5e5e5);
        }
        
        .filter-actions .apply-btn {
            flex: 1;
            padding: 0.625rem 1rem;
            background: var(--color-accent, #C75B3F);
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            transition: all 0.2s;
        }
        
        .filter-actions .apply-btn:hover {
            background: #B34A2E;
        }
        
        .filter-section {
            margin-bottom: 1.5rem;
        }
        
        .filter-section h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text-secondary, #666);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }
        
        .filter-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--color-accent, #C75B3F);
        }
        
        .filter-select option {
            padding: 0.25rem;
        }
        
        .filter-select option:disabled {
            color: #999;
            font-style: italic;
        }
        
        .clear-filters-btn {
            width: 100%;
            padding: 0.5rem 1rem;
            background: var(--color-surface, #f5f5f5);
            border: 1px solid var(--color-border, #ddd);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--color-text-secondary, #666);
            transition: all 0.2s;
        }
        
        .clear-filters-btn:hover {
            background: var(--color-border, #e5e5e5);
        }
        
        .active-filters {
            background: rgba(199, 91, 63, 0.1);
            border: 1px solid var(--color-accent, #C75B3F);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.75rem;
            color: var(--color-accent, #C75B3F);
        }
        
        .filter-loading {
            font-size: 0.75rem;
            color: #999;
            font-style: italic;
        }
        
        /* Main Content */
        .styles-main {
            flex: 1;
            overflow-y: auto;
            background: var(--color-background, #F5F0EB);
            display: flex;
            flex-direction: column;
        }
        
        /* Sticky Search Header */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--color-background, #F5F0EB);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--color-border, #e5e5e5);
        }
        
        /* Search Bar */
        .search-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }
        
        .search-input-wrapper {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            padding-right: 2.5rem;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 24px;
            font-size: 1rem;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--color-accent, #C75B3F);
            box-shadow: 0 0 0 3px rgba(199, 91, 63, 0.1);
        }
        
        .search-clear-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--color-text-secondary, #999);
            padding: 4px;
            display: none;
            border-radius: 50%;
            line-height: 1;
        }
        
        .search-clear-btn:hover {
            background: var(--color-border, #e5e5e5);
            color: var(--color-text, #333);
        }
        
        .search-clear-btn.visible {
            display: block;
        }
        
        /* Active Filter Pills */
        .filter-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .filter-pills:empty {
            display: none;
        }
        
        .filter-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            background: var(--color-text, #333);
            color: white;
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 500;
        }
        
        .filter-pill-remove {
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            padding: 0;
            line-height: 1;
            font-size: 1rem;
        }
        
        .filter-pill-remove:hover {
            color: white;
        }
        
        .reset-all-btn {
            padding: 0.375rem 0.75rem;
            background: transparent;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 20px;
            font-size: 0.8125rem;
            color: var(--color-text-secondary, #666);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-all-btn:hover {
            background: var(--color-border, #e5e5e5);
        }
        
        /* Search Hint & Results */
        .search-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        .search-hint {
            font-size: 0.75rem;
            color: var(--color-text-secondary, #999);
        }
        
        .results-count {
            color: var(--color-text-secondary, #666);
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        /* Scrollable content area */
        .styles-content {
            flex: 1;
            padding: 1.5rem;
        }
        
        /* Sort Dropdown */
        .sort-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .sort-container label {
            font-size: 0.875rem;
            color: var(--color-text-secondary, #666);
        }
        
        .sort-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }
        
        .sort-select:focus {
            outline: none;
            border-color: var(--color-accent, #C75B3F);
        }
        
        /* Quality Filter */
        .quality-filter-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .quality-filter-container label {
            font-size: 0.875rem;
            color: var(--color-text-secondary, #666);
        }
        
        .quality-filter-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
            min-width: 130px;
        }
        
        .quality-filter-select:focus {
            outline: none;
            border-color: var(--color-accent, #C75B3F);
        }
        
        /* Style Grid */
        .styles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.5rem;
        }
        
        .style-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
        }
        
        .style-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .style-card-image {
            aspect-ratio: 1;
            background: var(--color-surface, #f5f5f5);
            position: relative;
            overflow: hidden;
        }
        
        .style-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .style-card-image .placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-secondary, #999);
            font-size: 0.75rem;
        }
        
        .favorite-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            z-index: 2;
        }
        
        .favorite-btn:hover {
            transform: scale(1.1);
        }
        
        .favorite-btn.active svg {
            fill: #e74c3c;
        }
        
        /* Quality Score Badge */
        .quality-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.75);
            color: #ffd700;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            z-index: 2;
        }
        
        .style-card-info {
            padding: 0.75rem 1rem;
        }
        
        .style-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.25rem;
        }
        
        .style-card-id {
            font-size: 0.75rem;
            color: var(--color-text-secondary, #999);
        }
        
        /* Horizontal three-dot menu (Pinterest style) */
        .menu-btn-horizontal {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .style-card:hover .menu-btn-horizontal {
            opacity: 1;
        }
        
        .menu-btn-horizontal .dot {
            width: 4px;
            height: 4px;
            background: var(--color-text-secondary, #999);
            border-radius: 50%;
        }
        
        .menu-btn-horizontal:hover .dot {
            background: var(--color-text, #333);
        }
        
        .style-card-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text, #333);
            margin: 0;
            line-height: 1.3;
        }
        
        .style-card-tagline {
            font-size: 0.8rem;
            color: var(--color-text-secondary, #666);
            margin-top: 0.25rem;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
            padding: 1rem;
        }
        
        .pagination-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-border, #ddd);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--color-accent, #C75B3F);
            color: white;
            border-color: var(--color-accent, #C75B3F);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: var(--color-text-secondary, #666);
            font-size: 0.875rem;
        }
        
        /* Loading State */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--color-border, #ddd);
            border-top-color: var(--color-accent, #C75B3F);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Style Detail Modal */
        .style-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .style-modal.active {
            display: flex;
        }
        
        .style-modal-content {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .style-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border: none;
            background: var(--color-surface, #f5f5f5);
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .style-modal-gallery {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            padding: 1.5rem;
            background: var(--color-surface, #f5f5f5);
        }
        
        .style-modal-gallery img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .style-modal-gallery img:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .style-modal-info {
            padding: 1.5rem;
        }
        
        .style-modal-id {
            font-size: 0.875rem;
            color: var(--color-text-secondary, #999);
            margin-bottom: 0.25rem;
        }
        
        .style-modal-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 0.5rem;
        }
        
        .style-modal-tagline {
            font-size: 1rem;
            color: var(--color-accent, #C75B3F);
            margin-bottom: 1rem;
            font-style: italic;
        }
        
        .style-modal-description {
            color: var(--color-text-secondary, #666);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }
        
        .style-modal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .style-tag {
            background: var(--color-surface, #f5f5f5);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.8rem;
            color: var(--color-text-secondary, #666);
        }
        
        .style-modal-attributes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .attribute-item {
            background: var(--color-surface, #f5f5f5);
            padding: 0.75rem 1rem;
            border-radius: 8px;
        }
        
        .attribute-label {
            font-size: 0.75rem;
            color: var(--color-text-secondary, #999);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .attribute-value {
            font-weight: 500;
            color: var(--color-text, #333);
        }
        
        /* Lightbox for zoomed images */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            cursor: zoom-out;
        }
        
        .lightbox.active {
            display: flex;
        }
        
        .lightbox-content {
            position: relative;
            max-width: 95vw;
            max-height: 95vh;
        }
        
        .lightbox-image {
            max-width: 95vw;
            max-height: 95vh;
            object-fit: contain;
            border-radius: 8px;
            cursor: default;
        }
        
        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 2rem;
            padding: 1rem;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        .lightbox-nav:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .lightbox-prev {
            left: 1rem;
        }
        
        .lightbox-next {
            right: 1rem;
        }
        
        .lightbox-counter {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 0.875rem;
        }
        
        .lightbox-zoom-hint {
            position: absolute;
            bottom: -40px;
            right: 0;
            color: rgba(255,255,255,0.7);
            font-size: 0.75rem;
        }
        
        /* Zoomed state */
        .lightbox-image.zoomed {
            max-width: none;
            max-height: none;
            cursor: grab;
        }
        
        .lightbox-image.zoomed.dragging {
            cursor: grabbing;
        }
        
        /* Context Menu / Dropdown */
        .context-menu {
            display: none;
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            min-width: 200px;
            z-index: 3000;
            overflow: hidden;
        }
        
        .context-menu.active {
            display: block;
        }
        
        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.9375rem;
            color: var(--color-text, #333);
        }
        
        .context-menu-item:hover {
            background: var(--color-surface, #f5f5f5);
        }
        
        .context-menu-item svg {
            width: 20px;
            height: 20px;
            color: var(--color-text-secondary, #666);
        }
        
        .context-menu-divider {
            height: 1px;
            background: var(--color-border, #e5e5e5);
            margin: 0.25rem 0;
        }
        
        .context-menu-item.danger {
            color: #dc3545;
        }
        
        .context-menu-item.danger svg {
            color: #dc3545;
        }
        
        /* Collection Modal */
        .collection-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }
        
        .collection-modal.active {
            display: flex;
        }
        
        .collection-modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            max-height: 70vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .collection-modal-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--color-border, #e5e5e5);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .collection-modal-header h3 {
            margin: 0;
            font-size: 1.125rem;
        }
        
        .collection-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-text-secondary, #666);
        }
        
        .collection-modal-body {
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .collection-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .collection-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .collection-item:hover {
            border-color: var(--color-accent, #C75B3F);
            background: rgba(199, 91, 63, 0.05);
        }
        
        .collection-item.selected {
            border-color: var(--color-accent, #C75B3F);
            background: rgba(199, 91, 63, 0.1);
        }
        
        .collection-item-icon {
            width: 40px;
            height: 40px;
            background: var(--color-surface, #f5f5f5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .collection-item-info {
            flex: 1;
        }
        
        .collection-item-name {
            font-weight: 500;
        }
        
        .collection-item-count {
            font-size: 0.75rem;
            color: var(--color-text-secondary, #999);
        }
        
        .create-collection-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--color-border, #e5e5e5);
        }
        
        .create-collection-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .create-collection-btn {
            padding: 0.5rem 1rem;
            background: var(--color-accent, #C75B3F);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            z-index: 4000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Confirmation Modal */
        .confirm-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 4000;
            align-items: center;
            justify-content: center;
        }
        
        .confirm-modal.active {
            display: flex;
        }
        
        .confirm-modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .confirm-modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .confirm-modal-title {
            margin: 0 0 0.5rem;
            font-size: 1.25rem;
        }
        
        .confirm-modal-text {
            color: var(--color-text-secondary, #666);
            margin-bottom: 1.5rem;
            font-size: 0.9375rem;
        }
        
        .confirm-modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .confirm-btn-cancel {
            background: var(--color-surface, #f5f5f5);
            color: var(--color-text, #333);
        }
        
        .confirm-btn-cancel:hover {
            background: var(--color-border, #e5e5e5);
        }
        
        .confirm-btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .confirm-btn-danger:hover {
            background: #c82333;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .filter-sidebar {
                display: none;
            }
            
            .styles-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .style-modal-gallery {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .lightbox-nav {
                padding: 0.5rem;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="header-content">
            <a href="index.html" class="logo">Society Arts</a>
            <nav class="header-nav">
                <a href="story-builder.html">Story Builder</a>
                <a href="style-finder.html" class="active">Style Finder</a>
            </nav>
        </div>
    </header>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- Main Content -->
    <div class="style-finder-page">
        <!-- Filter Sidebar -->
        <aside class="filter-sidebar">
            <div id="activeFiltersDisplay" class="active-filters" style="display:none;"></div>
            
            <div class="filter-section">
                <h3>Search</h3>
                <input type="text" class="filter-select" id="sidebarSearch" placeholder="Search styles...">
            </div>
            
            <div class="filter-section">
                <h3>Art Type</h3>
                <select class="filter-select" id="filterArtType">
                    <option value="">All Art Types</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Medium</h3>
                <select class="filter-select" id="filterMedium">
                    <option value="">All Mediums</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Culture</h3>
                <select class="filter-select" id="filterCulture">
                    <option value="">All Cultures</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Era</h3>
                <select class="filter-select" id="filterEra">
                    <option value="">All Eras</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Palette</h3>
                <select class="filter-select" id="filterPalette">
                    <option value="">All Palettes</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Lighting</h3>
                <select class="filter-select" id="filterLighting">
                    <option value="">All Lighting</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Composition</h3>
                <select class="filter-select" id="filterComposition">
                    <option value="">All Compositions</option>
                </select>
            </div>
            
            <div class="filter-section">
                <h3>Complexity</h3>
                <select class="filter-select" id="filterComplexity">
                    <option value="">All Levels</option>
                    <option value="1">1 - Simple</option>
                    <option value="2">2 - Moderate</option>
                    <option value="3">3 - Complex</option>
                    <option value="4">4 - Very Complex</option>
                    <option value="5">5 - Highly Complex</option>
                </select>
            </div>
            
            <div class="filter-section">
                <button class="clear-filters-btn" id="clearFiltersBtn">Clear All Filters</button>
            </div>
            
            <!-- Reset/Apply Buttons -->
            <div class="filter-actions">
                <button class="reset-btn" id="resetFiltersBtn">Reset</button>
                <button class="apply-btn" id="applyFiltersBtn">Apply</button>
            </div>
        </aside>
        
        <!-- Styles Grid -->
        <main class="styles-main">
            <!-- Sticky Header -->
            <div class="sticky-header">
                <div class="search-bar">
                    <div class="search-input-wrapper">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search styles... (try: photography black white)">
                        <button class="search-clear-btn" id="searchClearBtn" title="Clear search">✕</button>
                    </div>
                    <div class="sort-container">
                        <label for="sortSelect">Sort:</label>
                        <select class="sort-select" id="sortSelect">
                            <option value="quality">Quality: High to Low</option>
                            <option value="qualityAsc">Quality: Low to High</option>
                            <option value="newest">Newest Arrivals</option>
                            <option value="featured">Featured</option>
                            <option value="nameAsc">Name: A to Z</option>
                            <option value="nameDesc">Name: Z to A</option>
                        </select>
                    </div>
                    <div class="quality-filter-container">
                        <label for="qualityFilter">Min:</label>
                        <select class="quality-filter-select" id="qualityFilter">
                            <option value="0">All</option>
                            <option value="6">6+</option>
                            <option value="7">7+</option>
                            <option value="8">8+</option>
                            <option value="9">9+</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                
                <!-- Active Filter Pills -->
                <div class="filter-pills" id="filterPills">
                    <!-- Filter pills inserted dynamically -->
                </div>
                
                <div class="search-meta">
                    <span class="search-hint">Tip: Use multiple words to narrow results</span>
                    <span class="results-count" id="resultsCount">Loading...</span>
                </div>
            </div>
            
            <!-- Scrollable Content -->
            <div class="styles-content">
                <div class="styles-grid" id="stylesGrid">
                    <!-- Styles will be inserted here -->
                </div>
                
                <div class="pagination" id="pagination">
                    <button class="pagination-btn" id="prevPageBtn" disabled>← Previous</button>
                    <span class="pagination-info" id="paginationInfo">Page 1 of 1</span>
                    <button class="pagination-btn" id="nextPageBtn">Next →</button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Style Detail Modal -->
    <div class="style-modal" id="styleModal">
        <div class="style-modal-content">
            <button class="style-modal-close" id="styleModalClose">×</button>
            <div class="style-modal-gallery" id="styleModalGallery">
                <!-- Images inserted here -->
            </div>
            <div class="style-modal-info">
                <div class="style-modal-id" id="styleModalId"></div>
                <h2 class="style-modal-name" id="styleModalName"></h2>
                <div class="style-modal-tagline" id="styleModalTagline"></div>
                <p class="style-modal-description" id="styleModalDescription"></p>
                <div class="style-modal-tags" id="styleModalTags"></div>
                <div class="style-modal-attributes" id="styleModalAttributes">
                    <!-- Attributes inserted here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lightbox for zoomed images -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" id="lightboxClose">×</button>
            <button class="lightbox-nav lightbox-prev" id="lightboxPrev">‹</button>
            <img class="lightbox-image" id="lightboxImage" src="" alt="Zoomed style image">
            <button class="lightbox-nav lightbox-next" id="lightboxNext">›</button>
            <div class="lightbox-counter" id="lightboxCounter">1 / 10</div>
            <div class="lightbox-zoom-hint">Click image to zoom in/out</div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <button class="context-menu-item" id="menuSave">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save
        </button>
        <button class="context-menu-item" id="menuAddToCollection">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Add to Collection
        </button>
        <div class="context-menu-divider"></div>
        <button class="context-menu-item" id="menuReportSwap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Flag for Review
        </button>
        <button class="context-menu-item danger" id="menuReportDelete">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            Unlist Style
        </button>
    </div>
    
    <!-- Collection Modal -->
    <div class="collection-modal" id="collectionModal">
        <div class="collection-modal-content">
            <div class="collection-modal-header">
                <h3>Add to Collection</h3>
                <button class="collection-modal-close" id="collectionModalClose">×</button>
            </div>
            <div class="collection-modal-body">
                <div class="collection-list" id="collectionList">
                    <!-- Collections inserted here -->
                </div>
                <div class="create-collection-form">
                    <input type="text" class="create-collection-input" id="newCollectionName" placeholder="New collection name...">
                    <button class="create-collection-btn" id="createCollectionBtn">Create</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon">⚠️</div>
            <h3 class="confirm-modal-title">Unlist This Style?</h3>
            <p class="confirm-modal-text">This will remove the style from the public gallery. It can be restored later by an admin.</p>
            <div class="confirm-modal-buttons">
                <button class="confirm-btn confirm-btn-cancel" id="confirmCancel">Cancel</button>
                <button class="confirm-btn confirm-btn-danger" id="confirmUnlist">Yes, Unlist</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/shared/supabase-client.js"></script>
    <script src="js/style-finder/style-data.js"></script>
    <script>
        // ============================================
        // DOM Elements
        // ============================================
        const loadingOverlay = document.getElementById('loadingOverlay');
        const stylesGrid = document.getElementById('stylesGrid');
        const searchInput = document.getElementById('searchInput');
        const searchClearBtn = document.getElementById('searchClearBtn');
        const sidebarSearch = document.getElementById('sidebarSearch');
        const resultsCount = document.getElementById('resultsCount');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const paginationInfo = document.getElementById('paginationInfo');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const filterPills = document.getElementById('filterPills');
        const styleModal = document.getElementById('styleModal');
        const styleModalClose = document.getElementById('styleModalClose');
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxCounter = document.getElementById('lightboxCounter');
        const contextMenu = document.getElementById('contextMenu');
        const collectionModal = document.getElementById('collectionModal');
        const toast = document.getElementById('toast');
        const activeFiltersDisplay = document.getElementById('activeFiltersDisplay');
        const sortSelect = document.getElementById('sortSelect');
        const qualityFilter = document.getElementById('qualityFilter');
        const confirmModal = document.getElementById('confirmModal');
        
        // Filter elements mapped to database columns
        const filterSelects = {
            art_type_id: document.getElementById('filterArtType'),
            primary_medium_id: document.getElementById('filterMedium'),
            culture_id: document.getElementById('filterCulture'),
            era_id: document.getElementById('filterEra'),
            primary_palette_id: document.getElementById('filterPalette'),
            primary_lighting_id: document.getElementById('filterLighting'),
            primary_composition_id: document.getElementById('filterComposition'),
            complexity: document.getElementById('filterComplexity')
        };
        
        // Lookup table mapping for smart facets
        const filterConfig = {
            art_type_id: { lookup: 'art_types', label: 'Art Type' },
            primary_medium_id: { lookup: 'mediums', label: 'Medium' },
            culture_id: { lookup: 'cultures', label: 'Culture' },
            era_id: { lookup: 'eras', label: 'Era' },
            primary_palette_id: { lookup: 'palettes', label: 'Palette' },
            primary_lighting_id: { lookup: 'lighting', label: 'Lighting' },
            primary_composition_id: { lookup: 'compositions', label: 'Composition' }
        };
        
        // State for lightbox
        let lightboxImages = [];
        let lightboxIndex = 0;
        let isZoomed = false;
        
        // State for context menu
        let currentMenuStyleId = null;
        let currentMenuImageUrl = null;
        
        // ============================================
        // Initialize
        // ============================================
        async function initialize() {
            showLoading(true);
            
            try {
                await SocietyArts.initializeStyleData();
                populateFilterDropdowns();
                renderStyles();
                updateResultsCount();
                updatePagination();
            } catch (error) {
                console.error('Initialization failed:', error);
                stylesGrid.innerHTML = '<p style="text-align:center;color:#999;padding:2rem;">Failed to load styles. Please refresh the page.</p>';
            } finally {
                showLoading(false);
            }
        }
        
        // ============================================
        // UI Functions
        // ============================================
        function showLoading(show) {
            loadingOverlay.classList.toggle('active', show);
        }
        
        function showToast(message, duration = 3000) {
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), duration);
        }
        
        // Populate dropdowns with counts (smart facets)
        function populateFilterDropdowns() {
            // Get actual filtered count (not sum of options)
            const totalFilteredStyles = SocietyArts.filteredStyles().length;
            
            Object.entries(filterSelects).forEach(([filterKey, selectEl]) => {
                if (filterKey === 'complexity') return; // Skip complexity
                
                const config = filterConfig[filterKey];
                if (!config) return;
                
                // Get options with counts
                const options = SocietyArts.getLookupOptionsWithCounts(config.lookup, filterKey);
                
                // Save current selection
                const currentValue = selectEl.value;
                
                // Clear and rebuild - show actual filtered count, not sum of options
                selectEl.innerHTML = `<option value="">All ${config.label}s (${totalFilteredStyles})</option>`;
                
                // Add options that have results, with counts
                options.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt.id;
                    option.textContent = `${opt.name} (${opt.count})`;
                    selectEl.appendChild(option);
                });
                
                // Restore selection if still valid
                if (currentValue && [...selectEl.options].some(o => o.value === currentValue)) {
                    selectEl.value = currentValue;
                }
                
                console.log(`Populated ${filterKey} with ${options.length} options (with counts)`);
            });
        }
        
        function updateActiveFiltersDisplay() {
            const activeFilters = [];
            Object.entries(filterSelects).forEach(([key, el]) => {
                if (el.value) {
                    const selectedOption = el.options[el.selectedIndex];
                    activeFilters.push(selectedOption.textContent.split(' (')[0]); // Remove count
                }
            });
            
            if (activeFilters.length > 0) {
                activeFiltersDisplay.style.display = 'block';
                activeFiltersDisplay.textContent = `Active: ${activeFilters.join(', ')}`;
            } else {
                activeFiltersDisplay.style.display = 'none';
            }
        }
        
        function renderStyles() {
            const styles = SocietyArts.getCurrentPageStyles();
            
            if (styles.length === 0) {
                stylesGrid.innerHTML = '<p style="text-align:center;color:#999;padding:2rem;grid-column:1/-1;">No styles found matching your criteria.</p>';
                return;
            }
            
            stylesGrid.innerHTML = styles.map(style => `
                <div class="style-card" data-style-id="${style.id}">
                    <div class="style-card-image">
                        <img src="${style.thumbnail}" alt="${style.name}" 
                             onerror="this.parentElement.innerHTML='<div class=\\'placeholder\\'>Image not available</div>'">
                        <button class="favorite-btn ${SocietyArts.isFavorite(style.id) ? 'active' : ''}" 
                                onclick="event.stopPropagation(); toggleFavorite('${style.id}', this)"
                                title="Add to favorites">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                        </button>
                        ${style.quality_score ? `<span class="quality-badge" title="Quality Score">${style.quality_score.toFixed(1)}</span>` : ''}
                    </div>
                    <div class="style-card-info">
                        <div class="style-card-header">
                            <div class="style-card-id">${style.id}</div>
                            <button class="menu-btn-horizontal" 
                                    onclick="event.stopPropagation(); openContextMenu(event, '${style.id}', '${style.thumbnail}')"
                                    title="More options">
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                            </button>
                        </div>
                        <h3 class="style-card-name">${style.name || 'Untitled Style'}</h3>
                        ${style.tagline ? `<div class="style-card-tagline">${style.tagline}</div>` : ''}
                    </div>
                </div>
            `).join('');
            
            document.querySelectorAll('.style-card').forEach(card => {
                card.addEventListener('click', () => openStyleModal(card.dataset.styleId));
            });
        }
        
        function updateResultsCount() {
            const total = SocietyArts.filteredStyles().length;
            resultsCount.textContent = `${total.toLocaleString()} style${total !== 1 ? 's' : ''}`;
        }
        
        function updatePagination() {
            const currentPage = SocietyArts.currentPage();
            const totalPages = SocietyArts.getTotalPages();
            
            prevPageBtn.disabled = currentPage === 0;
            nextPageBtn.disabled = currentPage >= totalPages - 1;
            paginationInfo.textContent = `Page ${currentPage + 1} of ${Math.max(1, totalPages)}`;
        }
        
        // ============================================
        // Search & Filter Handlers
        // ============================================
        let searchTimeout;
        async function handleSearch(value) {
            // Show/hide clear button
            searchClearBtn.classList.toggle('visible', value.length > 0);
            
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                showLoading(true);
                await SocietyArts.searchStyles(value);
                renderStyles();
                updateResultsCount();
                updatePagination();
                updateFilterPills();
                showLoading(false);
            }, 300);
        }
        
        searchInput.addEventListener('input', (e) => handleSearch(e.target.value));
        
        // Search clear button
        searchClearBtn.addEventListener('click', async () => {
            searchInput.value = '';
            searchClearBtn.classList.remove('visible');
            showLoading(true);
            await SocietyArts.searchStyles('');
            renderStyles();
            updateResultsCount();
            updatePagination();
            updateFilterPills();
            showLoading(false);
        });
        
        sidebarSearch.addEventListener('input', (e) => {
            searchInput.value = e.target.value;
            handleSearch(e.target.value);
        });
        
        // Filter change handler - instant apply
        Object.entries(filterSelects).forEach(([filterKey, selectEl]) => {
            selectEl.addEventListener('change', async () => {
                console.log(`Filter changed: ${filterKey} = "${selectEl.value}"`);
                
                showLoading(true);
                
                const filters = {};
                Object.entries(filterSelects).forEach(([key, el]) => {
                    if (el.value) {
                        if (key === 'complexity') {
                            filters[key] = parseInt(el.value);
                        } else {
                            filters[key] = el.value;
                        }
                    }
                });
                
                console.log('Applying filters:', filters);
                
                await SocietyArts.applyFilters(filters);
                
                // Refresh dropdowns with new counts (smart facets)
                populateFilterDropdowns();
                
                renderStyles();
                updateResultsCount();
                updatePagination();
                updateActiveFiltersDisplay();
                updateFilterPills();
                
                showLoading(false);
            });
        });
        
        // Clear all filters (sidebar button)
        clearFiltersBtn.addEventListener('click', async () => {
            await resetAllFilters();
        });
        
        // Reset button (sticky footer)
        resetFiltersBtn.addEventListener('click', async () => {
            await resetAllFilters();
        });
        
        // Apply button (currently instant-apply, but kept for UX consistency)
        applyFiltersBtn.addEventListener('click', () => {
            showToast('Filters applied!', 1500);
        });
        
        async function resetAllFilters() {
            showLoading(true);
            Object.values(filterSelects).forEach(el => el.value = '');
            searchInput.value = '';
            searchClearBtn.classList.remove('visible');
            if (sidebarSearch) sidebarSearch.value = '';
            qualityFilter.value = '0';
            await SocietyArts.setQualityThreshold(0);
            await SocietyArts.clearFilters();
            populateFilterDropdowns();
            renderStyles();
            updateResultsCount();
            updatePagination();
            updateActiveFiltersDisplay();
            updateFilterPills();
            showLoading(false);
        }
        
        // Update filter pills display
        function updateFilterPills() {
            const pills = [];
            const lookups = SocietyArts.getLookups();
            
            // Add search term pill
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                pills.push(`<span class="filter-pill">
                    Search: "${searchTerm}"
                    <button class="filter-pill-remove" data-action="clear-search">✕</button>
                </span>`);
            }
            
            // Add filter pills
            Object.entries(filterSelects).forEach(([filterKey, selectEl]) => {
                if (selectEl.value) {
                    const config = filterConfig[filterKey];
                    let displayValue = selectEl.value;
                    
                    if (config && lookups[config.lookup]) {
                        const item = lookups[config.lookup].find(l => l.id === selectEl.value);
                        if (item) displayValue = item.name;
                    } else if (filterKey === 'complexity') {
                        displayValue = selectEl.options[selectEl.selectedIndex].text;
                    }
                    
                    const label = config?.label || filterKey;
                    pills.push(`<span class="filter-pill">
                        ${label}: ${displayValue}
                        <button class="filter-pill-remove" data-filter="${filterKey}">✕</button>
                    </span>`);
                }
            });
            
            // Add quality filter pill
            const qualityValue = parseInt(qualityFilter.value);
            if (qualityValue > 0) {
                pills.push(`<span class="filter-pill">
                    Quality: ${qualityValue}+
                    <button class="filter-pill-remove" data-action="clear-quality">✕</button>
                </span>`);
            }
            
            // Add reset all button if there are any filters
            if (pills.length > 0) {
                pills.push(`<button class="reset-all-btn" id="resetAllPillsBtn">Reset All</button>`);
            }
            
            filterPills.innerHTML = pills.join('');
            
            // Add event listeners to pill remove buttons
            filterPills.querySelectorAll('.filter-pill-remove').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const filterKey = btn.dataset.filter;
                    const action = btn.dataset.action;
                    
                    if (action === 'clear-search') {
                        searchInput.value = '';
                        searchClearBtn.classList.remove('visible');
                        showLoading(true);
                        await SocietyArts.searchStyles('');
                    } else if (action === 'clear-quality') {
                        qualityFilter.value = '0';
                        showLoading(true);
                        await SocietyArts.setQualityThreshold(0);
                    } else if (filterKey) {
                        filterSelects[filterKey].value = '';
                        showLoading(true);
                        const filters = {};
                        Object.entries(filterSelects).forEach(([key, el]) => {
                            if (el.value) filters[key] = el.value;
                        });
                        await SocietyArts.applyFilters(filters);
                        populateFilterDropdowns();
                    }
                    
                    renderStyles();
                    updateResultsCount();
                    updatePagination();
                    updateActiveFiltersDisplay();
                    updateFilterPills();
                    showLoading(false);
                });
            });
            
            // Reset all button
            const resetAllBtn = filterPills.querySelector('#resetAllPillsBtn');
            if (resetAllBtn) {
                resetAllBtn.addEventListener('click', () => resetAllFilters());
            }
        }
        
        // Sort handler
        sortSelect.addEventListener('change', async () => {
            showLoading(true);
            await SocietyArts.setSort(sortSelect.value);
            renderStyles();
            updatePagination();
            showLoading(false);
        });
        
        // Quality filter handler
        qualityFilter.addEventListener('change', async () => {
            showLoading(true);
            await SocietyArts.setQualityThreshold(parseInt(qualityFilter.value));
            populateFilterDropdowns();
            renderStyles();
            updateResultsCount();
            updatePagination();
            showLoading(false);
        });
        
        // ============================================
        // Pagination
        // ============================================
        prevPageBtn.addEventListener('click', () => {
            SocietyArts.prevPage();
            renderStyles();
            updatePagination();
            document.querySelector('.styles-main').scrollTo(0, 0);
        });
        
        nextPageBtn.addEventListener('click', () => {
            SocietyArts.nextPage();
            renderStyles();
            updatePagination();
            document.querySelector('.styles-main').scrollTo(0, 0);
        });
        
        // ============================================
        // Favorites
        // ============================================
        function toggleFavorite(styleId, btn) {
            const result = SocietyArts.toggleFavorite(styleId);
            btn.classList.toggle('active', result.added);
            showToast(result.added ? 'Added to favorites' : 'Removed from favorites');
        }
        
        // ============================================
        // Style Modal - Now shows all related attributes
        // ============================================
        async function openStyleModal(styleId) {
            showLoading(true);
            const style = await SocietyArts.getStyleById(styleId);
            showLoading(false);
            
            if (!style) return;
            
            lightboxImages = style.images;
            
            const galleryHtml = style.images.map((url, i) => 
                `<img src="${url}" alt="${style.name} - Image ${i + 1}" 
                      onclick="openLightbox(${i})"
                      onerror="this.style.display='none'">`
            ).join('');
            document.getElementById('styleModalGallery').innerHTML = galleryHtml;
            
            document.getElementById('styleModalId').textContent = style.id;
            document.getElementById('styleModalName').textContent = style.name || 'Untitled Style';
            document.getElementById('styleModalTagline').textContent = style.tagline || '';
            document.getElementById('styleModalDescription').textContent = style.description || 'No description available.';
            
            // Show tags from junction tables
            const allTags = [
                ...(style.artTypes || []),
                ...(style.mediums || []),
                ...(style.cultures || []),
                ...(style.eras || []),
                ...(style.palettes || []),
                ...(style.lighting || []),
                ...(style.compositions || [])
            ];
            
            document.getElementById('styleModalTags').innerHTML = allTags.length > 0 
                ? allTags.map(tag => `<span class="style-tag">${tag}</span>`).join('')
                : '';
            
            const attributes = [
                ['Art Types', style.artTypes?.join(', ')],
                ['Mediums', style.mediums?.join(', ')],
                ['Cultures', style.cultures?.join(', ')],
                ['Eras', style.eras?.join(', ')],
                ['Palettes', style.palettes?.join(', ')],
                ['Lighting', style.lighting?.join(', ')],
                ['Compositions', style.compositions?.join(', ')],
                ['Complexity', style.complexity ? `Level ${style.complexity}` : null],
                ['Best Format', style.best_format],
                ['Best Size', style.best_size],
                ['SREF Code', style.sref_code]
            ].filter(([_, value]) => value);
            
            document.getElementById('styleModalAttributes').innerHTML = attributes.map(([label, value]) => `
                <div class="attribute-item">
                    <div class="attribute-label">${label}</div>
                    <div class="attribute-value">${value}</div>
                </div>
            `).join('');
            
            styleModal.classList.add('active');
        }
        
        styleModalClose.addEventListener('click', () => styleModal.classList.remove('active'));
        styleModal.addEventListener('click', (e) => {
            if (e.target === styleModal) styleModal.classList.remove('active');
        });
        
        // ============================================
        // Lightbox
        // ============================================
        function openLightbox(index) {
            lightboxIndex = index;
            updateLightbox();
            lightbox.classList.add('active');
        }
        
        function updateLightbox() {
            lightboxImage.src = lightboxImages[lightboxIndex];
            lightboxCounter.textContent = `${lightboxIndex + 1} / ${lightboxImages.length}`;
            lightboxImage.classList.remove('zoomed');
            isZoomed = false;
        }
        
        document.getElementById('lightboxClose').addEventListener('click', () => {
            lightbox.classList.remove('active');
        });
        
        document.getElementById('lightboxPrev').addEventListener('click', (e) => {
            e.stopPropagation();
            lightboxIndex = (lightboxIndex - 1 + lightboxImages.length) % lightboxImages.length;
            updateLightbox();
        });
        
        document.getElementById('lightboxNext').addEventListener('click', (e) => {
            e.stopPropagation();
            lightboxIndex = (lightboxIndex + 1) % lightboxImages.length;
            updateLightbox();
        });
        
        lightboxImage.addEventListener('click', (e) => {
            e.stopPropagation();
            isZoomed = !isZoomed;
            lightboxImage.classList.toggle('zoomed', isZoomed);
            if (isZoomed) {
                lightboxImage.style.width = '150%';
                lightboxImage.style.maxWidth = 'none';
            } else {
                lightboxImage.style.width = '';
                lightboxImage.style.maxWidth = '';
            }
        });
        
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
                lightbox.classList.remove('active');
            }
        });
        
        // ============================================
        // Context Menu
        // ============================================
        function openContextMenu(event, styleId, imageUrl) {
            event.preventDefault();
            currentMenuStyleId = styleId;
            currentMenuImageUrl = imageUrl;
            
            const x = Math.min(event.clientX, window.innerWidth - 220);
            const y = Math.min(event.clientY, window.innerHeight - 200);
            
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            contextMenu.classList.add('active');
        }
        
        document.addEventListener('click', () => {
            contextMenu.classList.remove('active');
        });
        
        document.getElementById('menuSave').addEventListener('click', async () => {
            if (!currentMenuStyleId) return;
            SocietyArts.saveStyle(currentMenuStyleId);
            showToast('Style saved to your collection!');
        });
        
        document.getElementById('menuAddToCollection').addEventListener('click', () => {
            if (!currentMenuStyleId) return;
            openCollectionModal();
        });
        
        document.getElementById('menuReportSwap').addEventListener('click', async () => {
            if (!currentMenuStyleId) return;
            const result = await SocietyArts.reportStyleForReview(currentMenuStyleId);
            showToast(result.message, 5000);
        });
        
        // Unlist style - show confirmation first
        let styleToUnlist = null;
        
        document.getElementById('menuReportDelete').addEventListener('click', () => {
            if (!currentMenuStyleId) return;
            styleToUnlist = currentMenuStyleId;
            confirmModal.classList.add('active');
        });
        
        document.getElementById('confirmCancel').addEventListener('click', () => {
            styleToUnlist = null;
            confirmModal.classList.remove('active');
        });
        
        document.getElementById('confirmUnlist').addEventListener('click', async () => {
            if (!styleToUnlist) return;
            
            confirmModal.classList.remove('active');
            showLoading(true);
            
            const result = await SocietyArts.unlistStyle(styleToUnlist);
            
            if (result.success) {
                renderStyles();
                updateResultsCount();
                updatePagination();
            }
            
            showLoading(false);
            showToast(result.message, 4000);
            styleToUnlist = null;
        });
        
        confirmModal.addEventListener('click', (e) => {
            if (e.target === confirmModal) {
                styleToUnlist = null;
                confirmModal.classList.remove('active');
            }
        });
        
        // ============================================
        // Collection Modal
        // ============================================
        function openCollectionModal() {
            renderCollectionList();
            collectionModal.classList.add('active');
        }
        
        function renderCollectionList() {
            const collections = SocietyArts.getCollections();
            const styleCollections = SocietyArts.getStyleCollections(currentMenuStyleId);
            const styleCollectionIds = styleCollections.map(c => c.id);
            
            if (collections.length === 0) {
                document.getElementById('collectionList').innerHTML = 
                    '<p style="color:#999;text-align:center;padding:1rem;">No collections yet. Create one below!</p>';
                return;
            }
            
            document.getElementById('collectionList').innerHTML = collections.map(col => `
                <div class="collection-item ${styleCollectionIds.includes(col.id) ? 'selected' : ''}" 
                     onclick="toggleCollection('${col.id}')">
                    <div class="collection-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                    </div>
                    <div class="collection-item-info">
                        <div class="collection-item-name">${col.name}</div>
                        <div class="collection-item-count">${col.styleIds.length} style${col.styleIds.length !== 1 ? 's' : ''}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function toggleCollection(collectionId) {
            const collections = SocietyArts.getStyleCollections(currentMenuStyleId);
            const isInCollection = collections.some(c => c.id === collectionId);
            
            if (isInCollection) {
                SocietyArts.removeFromCollection(collectionId, currentMenuStyleId);
                showToast('Removed from collection');
            } else {
                SocietyArts.addToCollection(collectionId, currentMenuStyleId);
                showToast('Added to collection');
            }
            
            renderCollectionList();
        }
        
        document.getElementById('collectionModalClose').addEventListener('click', () => {
            collectionModal.classList.remove('active');
        });
        
        collectionModal.addEventListener('click', (e) => {
            if (e.target === collectionModal) collectionModal.classList.remove('active');
        });
        
        document.getElementById('createCollectionBtn').addEventListener('click', () => {
            const input = document.getElementById('newCollectionName');
            const name = input.value.trim();
            
            if (!name) {
                showToast('Please enter a collection name');
                return;
            }
            
            SocietyArts.createCollection(name);
            input.value = '';
            renderCollectionList();
            showToast(`Collection "${name}" created`);
        });
        
        document.getElementById('newCollectionName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('createCollectionBtn').click();
            }
        });
        
        // ============================================
        // Keyboard Navigation
        // ============================================
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (confirmModal.classList.contains('active')) {
                    styleToUnlist = null;
                    confirmModal.classList.remove('active');
                } else if (lightbox.classList.contains('active')) {
                    lightbox.classList.remove('active');
                } else if (collectionModal.classList.contains('active')) {
                    collectionModal.classList.remove('active');
                } else if (styleModal.classList.contains('active')) {
                    styleModal.classList.remove('active');
                }
                contextMenu.classList.remove('active');
            }
            
            if (lightbox.classList.contains('active')) {
                if (e.key === 'ArrowLeft') {
                    document.getElementById('lightboxPrev').click();
                } else if (e.key === 'ArrowRight') {
                    document.getElementById('lightboxNext').click();
                }
            }
        });
        
        // ============================================
        // Start
        // ============================================
        initialize();
    </script>
</body>
</html>
