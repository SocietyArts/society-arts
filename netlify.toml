[build]
  publish = "."
  functions = "netlify/functions"

[functions]
  node_bundler = "esbuild"

# ============================================
# NETLIFY IMAGE CDN CONFIGURATION
# ============================================
# Enable on-demand image optimization for CloudFlare R2 images
# Images are resized, converted to modern formats (WebP/AVIF), and cached at edge

[images]
  remote_images = [
    "https://pub-acb560f551f141db830964aed1fa005f\\.r2\\.dev/.*",
    "https://pub-d4d49982f29749dea52e2eb37c29ad51\\.r2\\.dev/.*"
  ]

# Redirect /story-builder to story-builder.html
[[redirects]]
  from = "/story-builder"
  to = "/story-builder.html"
  status = 200

# Redirect /style-finder to style-finder.html  
[[redirects]]
  from = "/style-finder"
  to = "/style-finder.html"
  status = 200

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000"

# Cache optimized images for 1 year (they're immutable once generated)
[[headers]]
  for = "/.netlify/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
