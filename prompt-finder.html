<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt Finder | Society Arts</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --color-brown: #3E2318;
      --color-brown-60: #8B7B75;
      --color-beige: #EAE4DA;
      --color-tan-10: #F3F1EE;
      --color-tan-20: #E7E2DC;
      --color-orange: #C73314;
      --color-white: #FFFFFF;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--color-beige);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      color: var(--color-brown);
    }
    
    .container {
      width: 100%;
      max-width: 1100px;
    }
    
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .logo {
      height: 40px;
      margin-bottom: 24px;
    }
    
    .title {
      font-family: 'Domine', Georgia, serif;
      font-size: 28px;
      font-weight: 600;
      color: var(--color-brown);
      margin-bottom: 8px;
    }
    
    .subtitle {
      font-size: 15px;
      color: var(--color-brown-60);
    }
    
    /* Search Card */
    .search-card {
      background: var(--color-white);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 2px 8px rgba(62, 35, 24, 0.08);
      max-width: 600px;
      margin: 0 auto;
    }
    
    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 8px;
    }
    
    .style-input {
      flex: 1;
      padding: 16px 20px;
      font-size: 18px;
      font-family: 'Inter', sans-serif;
      border: 2px solid var(--color-tan-20);
      border-radius: 12px;
      background: var(--color-tan-10);
      color: var(--color-brown);
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .style-input:focus {
      outline: none;
      border-color: var(--color-brown);
      box-shadow: 0 0 0 3px rgba(62, 35, 24, 0.1);
    }
    
    .style-input::placeholder {
      text-transform: none;
      letter-spacing: normal;
      color: var(--color-brown-60);
    }
    
    .search-btn {
      padding: 16px 28px;
      font-size: 16px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      background: var(--color-brown);
      color: var(--color-white);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    
    .search-btn:hover {
      background: #2d1a12;
    }
    
    .search-btn:active {
      transform: scale(0.98);
    }
    
    .search-btn:disabled {
      background: var(--color-brown-60);
      cursor: not-allowed;
    }
    
    .input-hint {
      font-size: 13px;
      color: var(--color-brown-60);
      margin-left: 4px;
    }
    
    /* Results */
    .results {
      margin-top: 24px;
      display: none;
    }
    
    .results.visible {
      display: block;
    }
    
    .results-card {
      background: var(--color-white);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 2px 8px rgba(62, 35, 24, 0.08);
    }
    
    .results-layout {
      display: flex;
      gap: 32px;
      align-items: flex-start;
    }
    
    .results-content {
      flex: 0 0 280px;
      min-width: 0;
    }
    
    .results-image {
      flex: 1;
    }
    
    .style-image {
      width: 100%;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(62, 35, 24, 0.12);
    }
    
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .result-style-id {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: var(--color-brown-60);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .result-sref {
      font-size: 12px;
      color: var(--color-brown-60);
      background: var(--color-tan-10);
      padding: 4px 8px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    .result-title {
      font-family: 'Domine', Georgia, serif;
      font-size: 26px;
      font-weight: 600;
      color: var(--color-orange);
      margin: 0 0 16px 0;
      line-height: 1.3;
    }
    
    .prompt-box {
      background: var(--color-tan-10);
      border: 1px solid var(--color-tan-20);
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 16px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .prompt-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--color-brown-60);
      margin-bottom: 8px;
    }
    
    .prompt-text {
      font-size: 13px;
      line-height: 1.5;
      color: var(--color-brown);
      word-break: break-word;
    }
    
    .copy-btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      background: var(--color-orange);
      color: var(--color-white);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    
    .copy-btn:hover {
      background: #a82a10;
    }
    
    .copy-btn:active {
      transform: scale(0.98);
    }
    
    .copy-btn.copied {
      background: #4A9D6E;
    }
    
    /* Error State */
    .error {
      background: #FEF2F2;
      border: 1px solid #FECACA;
      border-radius: 12px;
      padding: 16px 20px;
      margin-top: 24px;
      display: none;
    }
    
    .error.visible {
      display: block;
    }
    
    .error-text {
      color: #B91C1C;
      font-size: 14px;
    }
    
    /* Prompt Warning */
    .prompt-warning {
      background: #FFFBEB;
      border: 1px solid #FCD34D;
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: none;
    }
    
    .prompt-warning.visible {
      display: block;
    }
    
    .prompt-warning p {
      color: #92400E;
      font-size: 13px;
      margin: 0;
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 24px;
      color: var(--color-brown-60);
      display: none;
    }
    
    .loading.visible {
      display: block;
    }
    
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--color-tan-20);
      border-top-color: var(--color-brown);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 12px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Footer */
    .footer {
      margin-top: 48px;
      text-align: center;
      font-size: 13px;
      color: var(--color-brown-60);
    }
    
    .footer a {
      color: var(--color-brown);
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .results-layout {
        flex-direction: column;
      }
      
      .results-content {
        flex: none;
        width: 100%;
      }
      
      .results-image {
        width: 100%;
        order: -1;
        margin-bottom: 20px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 24px 16px;
      }
      
      .title {
        font-size: 24px;
      }
      
      .search-card {
        padding: 24px;
      }
      
      .results-card {
        padding: 20px;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      .search-btn {
        width: 100%;
      }
      
      .result-title {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <img 
        src="https://pub-acb560f551f141db830964aed1fa005f.r2.dev/site-assets/SA_Wordmark_Brown%401x.png" 
        alt="Society Arts" 
        class="logo"
      >
      <h1 class="title">Prompt Finder</h1>
      <p class="subtitle">Look up Midjourney prompts by Style ID</p>
    </header>
    
    <!-- Search Card -->
    <div class="search-card">
      <div class="input-group">
        <input 
          type="text" 
          id="styleInput" 
          class="style-input" 
          placeholder="Enter Style ID (e.g., ABF-49)"
          maxlength="10"
          autocomplete="off"
          spellcheck="false"
        >
        <button id="searchBtn" class="search-btn">Find</button>
      </div>
      <p class="input-hint">Format: AAA-## (e.g., XYZ-12)</p>
      
      <!-- Loading State -->
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Searching...</p>
      </div>
      
      <!-- Error State -->
      <div id="error" class="error">
        <p class="error-text" id="errorText"></p>
      </div>
    </div>
    
    <!-- Results Card (separate for wider layout) -->
    <div id="results" class="results">
      <div class="results-card">
        <div class="results-layout">
          <div class="results-content">
            <div class="result-header">
              <span class="result-style-id" id="resultStyleId"></span>
              <span class="result-sref" id="resultSref"></span>
            </div>
            
            <h2 class="result-title" id="resultTitle"></h2>
            
            <div class="prompt-box">
              <p class="prompt-label">Midjourney Prompt</p>
              <p class="prompt-text" id="promptText"></p>
            </div>
            
            <div id="promptWarning" class="prompt-warning">
              <p>⚠️ This prompt is incomplete in our system. The authorities have been notified.</p>
            </div>
            
            <button id="copyBtn" class="copy-btn">Copy Prompt</button>
          </div>
          
          <div class="results-image">
            <img id="styleImage" src="" alt="Style preview" class="style-image">
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
      <p>Internal Tool • <a href="https://societyarts.com">Society Arts</a></p>
    </footer>
  </div>
  
  <script>
    // ========================================
    // SUPABASE REST API CONFIG
    // Using fetch instead of JS client for compatibility
    // ========================================
    const SUPABASE_URL = 'https://yspxlhcebcijeuemkaed.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzcHhsaGNlYmNpamV1ZW1rYWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzMTczMTQsImV4cCI6MjA4MTg5MzMxNH0.MD0xQGkLnNdQ4hebC06lijU96AbPHPULhW_vjXuiGGE';
    
    // ========================================
    // DOM ELEMENTS
    // ========================================
    const styleInput = document.getElementById('styleInput');
    const searchBtn = document.getElementById('searchBtn');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const errorText = document.getElementById('errorText');
    const results = document.getElementById('results');
    const resultStyleId = document.getElementById('resultStyleId');
    const resultSref = document.getElementById('resultSref');
    const resultTitle = document.getElementById('resultTitle');
    const promptText = document.getElementById('promptText');
    const copyBtn = document.getElementById('copyBtn');
    const styleImage = document.getElementById('styleImage');
    
    // ========================================
    // CONSTANTS
    // ========================================
    const R2_BASE_URL = 'https://pub-acb560f551f141db830964aed1fa005f.r2.dev';
    
    // ========================================
    // STATE
    // ========================================
    let currentPrompt = '';
    
    // ========================================
    // FUNCTIONS
    // ========================================
    
    function showLoading() {
      loading.classList.add('visible');
      error.classList.remove('visible');
      results.classList.remove('visible');
      searchBtn.disabled = true;
    }
    
    function hideLoading() {
      loading.classList.remove('visible');
      searchBtn.disabled = false;
    }
    
    function showError(message) {
      hideLoading();
      errorText.textContent = message;
      error.classList.add('visible');
      results.classList.remove('visible');
    }
    
    function showResults(data) {
      hideLoading();
      error.classList.remove('visible');
      results.classList.add('visible');
      
      const styleId = data.style_id;
      
      resultStyleId.textContent = styleId;
      resultSref.textContent = data.sref_code ? `sRef: ${data.sref_code}` : 'No sRef';
      
      // Display title
      const title = data.title || 'Untitled Style';
      resultTitle.textContent = title;
      
      // Display image from CloudFlare R2
      styleImage.src = `${R2_BASE_URL}/${styleId}/${styleId}-00.webp`;
      styleImage.alt = `${title} - Style ${styleId}`;
      
      // Combine prompt_core and prompt_suffix
      const fullPrompt = [data.prompt_core, data.prompt_suffix].filter(Boolean).join(' ');
      promptText.textContent = fullPrompt || 'No prompt available';
      currentPrompt = fullPrompt || '';
      
      // Check if prompt is incomplete (missing suffix)
      const warningEl = document.getElementById('promptWarning');
      if (!data.prompt_suffix) {
        warningEl.classList.add('visible');
      } else {
        warningEl.classList.remove('visible');
      }
      
      // Reset copy button
      copyBtn.textContent = 'Copy Prompt';
      copyBtn.classList.remove('copied');
    }
    
    function formatStyleId(input) {
      // Remove any non-alphanumeric characters except hyphen
      let cleaned = input.toUpperCase().replace(/[^A-Z0-9-]/g, '');
      
      // If they entered without hyphen (e.g., "ABF49"), try to format it
      if (cleaned.length >= 4 && !cleaned.includes('-')) {
        // Check if it looks like AAA## format
        const letters = cleaned.match(/^[A-Z]+/);
        const numbers = cleaned.match(/\d+$/);
        if (letters && numbers) {
          cleaned = `${letters[0]}-${numbers[0]}`;
        }
      }
      
      return cleaned;
    }
    
    async function searchPrompt() {
      const rawInput = styleInput.value.trim();
      if (!rawInput) {
        showError('Please enter a Style ID');
        return;
      }
      
      const styleId = formatStyleId(rawInput);
      
      // Basic validation
      if (!styleId.match(/^[A-Z]{2,4}-\d{1,2}$/)) {
        showError('Invalid format. Use AAA-## (e.g., ABF-49, XY-7)');
        return;
      }
      
      showLoading();
      
      try {
        // Query prompts table
        const promptsUrl = `${SUPABASE_URL}/rest/v1/prompts?style_id=eq.${styleId}&select=style_id,prompt_core,prompt_suffix,sref_code`;
        
        const promptsResponse = await fetch(promptsUrl, {
          method: 'GET',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (!promptsResponse.ok) {
          const errorData = await promptsResponse.json();
          console.error('API Error:', errorData);
          showError(`API Error: ${errorData.message || promptsResponse.status}`);
          return;
        }
        
        const promptsData = await promptsResponse.json();
        
        if (!promptsData || promptsData.length === 0) {
          showError(`Style "${styleId}" not found in database`);
          return;
        }
        
        // Query styles table for name
        const stylesUrl = `${SUPABASE_URL}/rest/v1/styles?id=eq.${styleId}&select=name`;
        
        const stylesResponse = await fetch(stylesUrl, {
          method: 'GET',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json'
          }
        });
        
        let title = 'Untitled Style';
        if (stylesResponse.ok) {
          const stylesData = await stylesResponse.json();
          if (stylesData && stylesData.length > 0 && stylesData[0].name) {
            title = stylesData[0].name;
          }
        }
        
        // Combine data
        const data = {
          ...promptsData[0],
          title: title
        };
        
        showResults(data);
        
      } catch (err) {
        console.error('Fetch error:', err);
        showError('Connection error. Please check your internet.');
      }
    }
    
    async function copyPrompt() {
      if (!currentPrompt) return;
      
      try {
        await navigator.clipboard.writeText(currentPrompt);
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = 'Copy Prompt';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = currentPrompt;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = 'Copy Prompt';
          copyBtn.classList.remove('copied');
        }, 2000);
      }
    }
    
    // ========================================
    // EVENT LISTENERS
    // ========================================
    
    searchBtn.addEventListener('click', searchPrompt);
    
    styleInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchPrompt();
      }
    });
    
    copyBtn.addEventListener('click', copyPrompt);
    
    // Auto-focus input on load
    styleInput.focus();
  </script>
</body>
</html>
